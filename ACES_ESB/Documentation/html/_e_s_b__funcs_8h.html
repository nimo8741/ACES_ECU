<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACES ESB: C:/Users/nickm/Documents/GitHub/ACES_ECU/ACES_ESB/ESB_funcs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACES ESB
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Software Implementation of Team ACES ESB</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">C:/Users/nickm/Documents/GitHub/ACES_ECU/ACES_ESB/ESB_funcs.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Function prototypes, macros, constants, and global variables for ESB microcontroller.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;avr/sfr_defs.h&gt;</code><br />
<code>#include &lt;float.h&gt;</code><br />
</div>
<p><a href="_e_s_b__funcs_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3b034cb1d74b9addc7599bd6ea6bd0d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a3b034cb1d74b9addc7599bd6ea6bd0d9">bit_is_set</a>(sfr,  bit)&#160;&#160;&#160;(_SFR_BYTE(sfr) &amp; _BV(bit))</td></tr>
<tr class="memdesc:a3b034cb1d74b9addc7599bd6ea6bd0d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple function define for testing if the bit is set.  <a href="#a3b034cb1d74b9addc7599bd6ea6bd0d9">More...</a><br /></td></tr>
<tr class="separator:a3b034cb1d74b9addc7599bd6ea6bd0d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad188fb0fbfd923bdb01294072367d024"><td class="memItemLeft" align="right" valign="top"><a id="ad188fb0fbfd923bdb01294072367d024"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(sfr,  bit)&#160;&#160;&#160;(!(_SFR_BYTE(sfr) &amp; _BV(bit)))</td></tr>
<tr class="memdesc:ad188fb0fbfd923bdb01294072367d024"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple function define for testing if the bit is clear. <br /></td></tr>
<tr class="separator:ad188fb0fbfd923bdb01294072367d024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a529c48ecd33900da7d406cbddf53f896"><td class="memItemLeft" align="right" valign="top"><a id="a529c48ecd33900da7d406cbddf53f896"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SSACTIVE</b>&#160;&#160;&#160;<a class="el" href="_e_s_b__funcs_8h.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;SPI_PORT, CJC_SS, 0)</td></tr>
<tr class="separator:a529c48ecd33900da7d406cbddf53f896"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e04e2578376c237329fa305e640f214"><td class="memItemLeft" align="right" valign="top"><a id="a4e04e2578376c237329fa305e640f214"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SSPASSIVE</b>&#160;&#160;&#160;<a class="el" href="_e_s_b__funcs_8h.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;SPI_PORT, CJC_SS, 1)</td></tr>
<tr class="separator:a4e04e2578376c237329fa305e640f214"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a062607eaaffe8c3f8193991755e024f9"><td class="memItemLeft" align="right" valign="top"><a id="a062607eaaffe8c3f8193991755e024f9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>K_factor</b>&#160;&#160;&#160;91387</td></tr>
<tr class="separator:a062607eaaffe8c3f8193991755e024f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a959f7b5d831006ba86ebf2754975fdfc"><td class="memItemLeft" align="right" valign="top"><a id="a959f7b5d831006ba86ebf2754975fdfc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>density</b>&#160;&#160;&#160;0.81</td></tr>
<tr class="separator:a959f7b5d831006ba86ebf2754975fdfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f24004cae5e9f858db493e25febf8c8"><td class="memItemLeft" align="right" valign="top"><a id="a8f24004cae5e9f858db493e25febf8c8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>pump_m</b>&#160;&#160;&#160;0.382587</td></tr>
<tr class="separator:a8f24004cae5e9f858db493e25febf8c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a355b9fced824741eba5498a7bc74371e"><td class="memItemLeft" align="right" valign="top"><a id="a355b9fced824741eba5498a7bc74371e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>pump_b</b>&#160;&#160;&#160;0.195783</td></tr>
<tr class="separator:a355b9fced824741eba5498a7bc74371e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f29307316da99a662028868a7f7636d"><td class="memItemLeft" align="right" valign="top"><a id="a0f29307316da99a662028868a7f7636d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>max_time</b>&#160;&#160;&#160;0.25</td></tr>
<tr class="separator:a0f29307316da99a662028868a7f7636d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a302251d845a16c65382845bf0ce773"><td class="memItemLeft" align="right" valign="top"><a id="a2a302251d845a16c65382845bf0ce773"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>pump_tot_V</b>&#160;&#160;&#160;9.9</td></tr>
<tr class="separator:a2a302251d845a16c65382845bf0ce773"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cdc28707cb436132ebcdc43607de5f1"><td class="memItemLeft" align="right" valign="top"><a id="a5cdc28707cb436132ebcdc43607de5f1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>gVolts</b>&#160;&#160;&#160;1.75</td></tr>
<tr class="separator:a5cdc28707cb436132ebcdc43607de5f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75bcee4b28157d51fa12c57a1a5d321a"><td class="memItemLeft" align="right" valign="top"><a id="a75bcee4b28157d51fa12c57a1a5d321a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>Kp</b>&#160;&#160;&#160;-0.0006</td></tr>
<tr class="separator:a75bcee4b28157d51fa12c57a1a5d321a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91066ed459a1747b160e47aa1dd54e36"><td class="memItemLeft" align="right" valign="top"><a id="a91066ed459a1747b160e47aa1dd54e36"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>Kd</b>&#160;&#160;&#160;-0.0004</td></tr>
<tr class="separator:a91066ed459a1747b160e47aa1dd54e36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a776129dfecab589b5ddfa410a1116ff1"><td class="memItemLeft" align="right" valign="top"><a id="a776129dfecab589b5ddfa410a1116ff1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>lube_factor</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a776129dfecab589b5ddfa410a1116ff1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c98dcd34a23663b13d503445091f121"><td class="memItemLeft" align="right" valign="top"><a id="a5c98dcd34a23663b13d503445091f121"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>sMotor</b>&#160;&#160;&#160;5.0</td></tr>
<tr class="separator:a5c98dcd34a23663b13d503445091f121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac805b951803c8d61809e8344c97c67f1"><td class="memItemLeft" align="right" valign="top"><a id="ac805b951803c8d61809e8344c97c67f1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>errorAllow</b>&#160;&#160;&#160;0.2</td></tr>
<tr class="separator:ac805b951803c8d61809e8344c97c67f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2836070a7b6248bcb38d482c649444d1"><td class="memItemLeft" align="right" valign="top"><a id="a2836070a7b6248bcb38d482c649444d1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>max_len</b>&#160;&#160;&#160;50</td></tr>
<tr class="separator:a2836070a7b6248bcb38d482c649444d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a30c44a201d94cde34e85247689b6d6"><td class="memItemLeft" align="right" valign="top"><a id="a7a30c44a201d94cde34e85247689b6d6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>allData</b>&#160;&#160;&#160;9</td></tr>
<tr class="separator:a7a30c44a201d94cde34e85247689b6d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bcd6bd7c87df33b0c950e8b5be2b4e0"><td class="memItemLeft" align="right" valign="top"><a id="a6bcd6bd7c87df33b0c950e8b5be2b4e0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ECU_timer_val</b>&#160;&#160;&#160;3036</td></tr>
<tr class="separator:a6bcd6bd7c87df33b0c950e8b5be2b4e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a375fe1b41006601d1eef7aa4e2815a61"><td class="memItemLeft" align="right" valign="top"><a id="a375fe1b41006601d1eef7aa4e2815a61"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HallTime</b>&#160;&#160;&#160;2760</td></tr>
<tr class="separator:a375fe1b41006601d1eef7aa4e2815a61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88157075c2391856115adff49fdcff5a"><td class="memItemLeft" align="right" valign="top"><a id="a88157075c2391856115adff49fdcff5a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CJC_MSK</b>&#160;&#160;&#160;0x7</td></tr>
<tr class="separator:a88157075c2391856115adff49fdcff5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e4009849c59f1806836e0c601827e66"><td class="memItemLeft" align="right" valign="top"><a id="a9e4009849c59f1806836e0c601827e66"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>normalDataIn</b>&#160;&#160;&#160;11</td></tr>
<tr class="separator:a9e4009849c59f1806836e0c601827e66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7334c540878c8c4d801fd75ed9fd8063"><td class="memItemLeft" align="right" valign="top"><a id="a7334c540878c8c4d801fd75ed9fd8063"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MISO</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a7334c540878c8c4d801fd75ed9fd8063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d3f11f2fdf8a7e27b975291e0c2c8cc"><td class="memItemLeft" align="right" valign="top"><a id="a5d3f11f2fdf8a7e27b975291e0c2c8cc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MOSI</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a5d3f11f2fdf8a7e27b975291e0c2c8cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dd443a4430713d325ab86895a4a45eb"><td class="memItemLeft" align="right" valign="top"><a id="a2dd443a4430713d325ab86895a4a45eb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SCK</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a2dd443a4430713d325ab86895a4a45eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ec8de10e7b72bf67907870262bf9768"><td class="memItemLeft" align="right" valign="top"><a id="a0ec8de10e7b72bf67907870262bf9768"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CJC_SS</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a0ec8de10e7b72bf67907870262bf9768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a893d36a22e3a678b3bff5a1f81b6571f"><td class="memItemLeft" align="right" valign="top"><a id="a893d36a22e3a678b3bff5a1f81b6571f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>glowPin</b>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a893d36a22e3a678b3bff5a1f81b6571f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a862d30e1f1ebe702b955f502dafe4a49"><td class="memItemLeft" align="right" valign="top"><a id="a862d30e1f1ebe702b955f502dafe4a49"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>solePin</b>&#160;&#160;&#160;5</td></tr>
<tr class="separator:a862d30e1f1ebe702b955f502dafe4a49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fb24b3499bfbc5a96e5b611157fda33"><td class="memItemLeft" align="right" valign="top"><a id="a6fb24b3499bfbc5a96e5b611157fda33"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>lubePin</b>&#160;&#160;&#160;6</td></tr>
<tr class="separator:a6fb24b3499bfbc5a96e5b611157fda33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a054898fe67c4f248617c7fc6c6549c"><td class="memItemLeft" align="right" valign="top"><a id="a6a054898fe67c4f248617c7fc6c6549c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>startPin</b>&#160;&#160;&#160;7</td></tr>
<tr class="separator:a6a054898fe67c4f248617c7fc6c6549c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f573720c7e3a3644d7d248f0e945f0c"><td class="memItemLeft" align="right" valign="top"><a id="a5f573720c7e3a3644d7d248f0e945f0c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>pumpPin</b>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a5f573720c7e3a3644d7d248f0e945f0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8112c985f7444e82198d7571ce0a9160"><td class="memItemLeft" align="right" valign="top"><a id="a8112c985f7444e82198d7571ce0a9160"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SPI_PORT</b>&#160;&#160;&#160;PORTB</td></tr>
<tr class="separator:a8112c985f7444e82198d7571ce0a9160"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a23459ced73501cbafb717ca9cbb10ce7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a23459ced73501cbafb717ca9cbb10ce7">Initial</a> (void)</td></tr>
<tr class="memdesc:a23459ced73501cbafb717ca9cbb10ce7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the microcontroller for its mainline execution.  <a href="#a23459ced73501cbafb717ca9cbb10ce7">More...</a><br /></td></tr>
<tr class="separator:a23459ced73501cbafb717ca9cbb10ce7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a> (volatile uint8_t *sfr, uint8_t bit, uint8_t val)</td></tr>
<tr class="memdesc:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the specified bit to the specified value or does nothing if it already set to that.  <a href="#aba7fa75d6dd6ebcdc6225282a798fcd2">More...</a><br /></td></tr>
<tr class="separator:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c9d5e29ad8899afe0c34571ddee18f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a1c9d5e29ad8899afe0c34571ddee18f9">shutdown</a> (void)</td></tr>
<tr class="memdesc:a1c9d5e29ad8899afe0c34571ddee18f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forces an engine shutdown and closes all output ports which could actuate the engine.  <a href="#a1c9d5e29ad8899afe0c34571ddee18f9">More...</a><br /></td></tr>
<tr class="separator:a1c9d5e29ad8899afe0c34571ddee18f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0c801cf89f8b3058ff2460c666154c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#ab0c801cf89f8b3058ff2460c666154c3">startup</a> (void)</td></tr>
<tr class="memdesc:ab0c801cf89f8b3058ff2460c666154c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the function calls in order such that and engine startup would occur.  <a href="#ab0c801cf89f8b3058ff2460c666154c3">More...</a><br /></td></tr>
<tr class="separator:ab0c801cf89f8b3058ff2460c666154c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54163ad9d4f9e7fa08b4aae836a1b316"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a54163ad9d4f9e7fa08b4aae836a1b316">throttle</a> (void)</td></tr>
<tr class="memdesc:a54163ad9d4f9e7fa08b4aae836a1b316"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the fuel flow rate such that the engine would operate at a desired throttle value.  <a href="#a54163ad9d4f9e7fa08b4aae836a1b316">More...</a><br /></td></tr>
<tr class="separator:a54163ad9d4f9e7fa08b4aae836a1b316"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa94fbe612c655551cc89eecee4aa8c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#afa94fbe612c655551cc89eecee4aa8c0">EGT_collect</a> (void)</td></tr>
<tr class="memdesc:afa94fbe612c655551cc89eecee4aa8c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collects the temperature from the Exhaust Gas Thermocouple and then packages/send data to the ECU.  <a href="#afa94fbe612c655551cc89eecee4aa8c0">More...</a><br /></td></tr>
<tr class="separator:afa94fbe612c655551cc89eecee4aa8c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc743b5d0a4916b1e4cef66e569811fe"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#acc743b5d0a4916b1e4cef66e569811fe">SPI_Receive</a> (void)</td></tr>
<tr class="memdesc:acc743b5d0a4916b1e4cef66e569811fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the operations needed to communicate with the CJC via SPI.  <a href="#acc743b5d0a4916b1e4cef66e569811fe">More...</a><br /></td></tr>
<tr class="separator:acc743b5d0a4916b1e4cef66e569811fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebf54b1b64a7ea55a7c392688cbdbae6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#aebf54b1b64a7ea55a7c392688cbdbae6">getTemp</a> (uint8_t *tempString)</td></tr>
<tr class="memdesc:aebf54b1b64a7ea55a7c392688cbdbae6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts the bytes received from the CJC into a usable temperature.  <a href="#aebf54b1b64a7ea55a7c392688cbdbae6">More...</a><br /></td></tr>
<tr class="separator:aebf54b1b64a7ea55a7c392688cbdbae6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adeadb2e1fc786ce91bfbd2c1c4ac4513"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#adeadb2e1fc786ce91bfbd2c1c4ac4513">package_message</a> (void)</td></tr>
<tr class="memdesc:adeadb2e1fc786ce91bfbd2c1c4ac4513"><td class="mdescLeft">&#160;</td><td class="mdescRight">Packages the message to later be sent to the ECU.  <a href="#adeadb2e1fc786ce91bfbd2c1c4ac4513">More...</a><br /></td></tr>
<tr class="separator:adeadb2e1fc786ce91bfbd2c1c4ac4513"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bb63dcf5362454afa9c040947c372ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a3bb63dcf5362454afa9c040947c372ae">compressor</a> (void)</td></tr>
<tr class="memdesc:a3bb63dcf5362454afa9c040947c372ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the duty cycle for the starter motor such that the compressor safely reaches a desired RPM.  <a href="#a3bb63dcf5362454afa9c040947c372ae">More...</a><br /></td></tr>
<tr class="separator:a3bb63dcf5362454afa9c040947c372ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a973541bd9d7a03580e58b233eb35de06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a973541bd9d7a03580e58b233eb35de06">fuel_puffs</a> (void)</td></tr>
<tr class="memdesc:a973541bd9d7a03580e58b233eb35de06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Operates the fuel pump and fuel/lubrication solenoids such that ignition begins in the combustion chamber.  <a href="#a973541bd9d7a03580e58b233eb35de06">More...</a><br /></td></tr>
<tr class="separator:a973541bd9d7a03580e58b233eb35de06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b71bd44c46c9be20f29250cacab8a6b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a7b71bd44c46c9be20f29250cacab8a6b">heatSoaking</a> (void)</td></tr>
<tr class="memdesc:a7b71bd44c46c9be20f29250cacab8a6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prevents interruptions from the operation of the engine so that the temperature of the combustion can will increase.  <a href="#a7b71bd44c46c9be20f29250cacab8a6b">More...</a><br /></td></tr>
<tr class="separator:a7b71bd44c46c9be20f29250cacab8a6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a154a9f374d6a56c8d416a756891cc60e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a154a9f374d6a56c8d416a756891cc60e">setPWM</a> (void)</td></tr>
<tr class="memdesc:a154a9f374d6a56c8d416a756891cc60e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets all of the Initializations for the PWMs for the Fuel Pump, Solenoids, and Starter Motor.  <a href="#a154a9f374d6a56c8d416a756891cc60e">More...</a><br /></td></tr>
<tr class="separator:a154a9f374d6a56c8d416a756891cc60e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24cdf62b1d79063305146ff04981c16a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a24cdf62b1d79063305146ff04981c16a">coolingMode</a> (void)</td></tr>
<tr class="memdesc:a24cdf62b1d79063305146ff04981c16a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shuts off the engine with the exception of the starter motor to force cool air through the engine.  <a href="#a24cdf62b1d79063305146ff04981c16a">More...</a><br /></td></tr>
<tr class="separator:a24cdf62b1d79063305146ff04981c16a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f55e4fd918cddf02226290d77ac2044"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a5f55e4fd918cddf02226290d77ac2044">sendToECU</a> (uint8_t len)</td></tr>
<tr class="memdesc:a5f55e4fd918cddf02226290d77ac2044"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routine to send a number of bytes to the ECU over RS232.  <a href="#a5f55e4fd918cddf02226290d77ac2044">More...</a><br /></td></tr>
<tr class="separator:a5f55e4fd918cddf02226290d77ac2044"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfac85317b9c1522c7b5196d94e471bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a> (uint16_t msec)</td></tr>
<tr class="memdesc:abfac85317b9c1522c7b5196d94e471bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Waits for a designated number of milliseconds.  <a href="#abfac85317b9c1522c7b5196d94e471bd">More...</a><br /></td></tr>
<tr class="separator:abfac85317b9c1522c7b5196d94e471bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d9918c69a50a7624dc0b89b416ba139"><td class="memItemLeft" align="right" valign="top"><a id="a9d9918c69a50a7624dc0b89b416ba139"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>ECUconnect</b> (void)</td></tr>
<tr class="separator:a9d9918c69a50a7624dc0b89b416ba139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90b932ca406d71217e71949d18161eba"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a90b932ca406d71217e71949d18161eba">calculateParity</a> (uint8_t message[], uint8_t start_index)</td></tr>
<tr class="memdesc:a90b932ca406d71217e71949d18161eba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the parity bytes for a set of 6 bytes.  <a href="#a90b932ca406d71217e71949d18161eba">More...</a><br /></td></tr>
<tr class="separator:a90b932ca406d71217e71949d18161eba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a441b2acdbd4ceef9784fe36d842f3df6"><td class="memItemLeft" align="right" valign="top"><a id="a441b2acdbd4ceef9784fe36d842f3df6"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>countOnes</b> (uint8_t byte)</td></tr>
<tr class="separator:a441b2acdbd4ceef9784fe36d842f3df6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9fb91c429d399f97b97f61cf8df4d70"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#af9fb91c429d399f97b97f61cf8df4d70">checkParity</a> (void)</td></tr>
<tr class="memdesc:af9fb91c429d399f97b97f61cf8df4d70"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function checks that the parity bytes sent by the ECU match what the ESB generates.  <a href="#af9fb91c429d399f97b97f61cf8df4d70">More...</a><br /></td></tr>
<tr class="separator:af9fb91c429d399f97b97f61cf8df4d70"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a91553b72c9b4759ddb48feffd7f2ffb1"><td class="memItemLeft" align="right" valign="top"><a id="a91553b72c9b4759ddb48feffd7f2ffb1"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a91553b72c9b4759ddb48feffd7f2ffb1">connected</a></td></tr>
<tr class="memdesc:a91553b72c9b4759ddb48feffd7f2ffb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This will describe whether or not the ESB is connected to the ECU. <br /></td></tr>
<tr class="separator:a91553b72c9b4759ddb48feffd7f2ffb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07a924cfb101a7d1ce3489f00b9da976"><td class="memItemLeft" align="right" valign="top"><a id="a07a924cfb101a7d1ce3489f00b9da976"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></td></tr>
<tr class="memdesc:a07a924cfb101a7d1ce3489f00b9da976"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes critical information about the current state of the engine. <br /></td></tr>
<tr class="separator:a07a924cfb101a7d1ce3489f00b9da976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a715738e95d6e1917be2e5d209d416ff2"><td class="memItemLeft" align="right" valign="top"><a id="a715738e95d6e1917be2e5d209d416ff2"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a715738e95d6e1917be2e5d209d416ff2">throttle_val</a></td></tr>
<tr class="memdesc:a715738e95d6e1917be2e5d209d416ff2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Value 1-100 for the the user wants to set the throttle to. <br /></td></tr>
<tr class="separator:a715738e95d6e1917be2e5d209d416ff2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3715e08cbd719300a7d01c9633cb3c2"><td class="memItemLeft" align="right" valign="top"><a id="ac3715e08cbd719300a7d01c9633cb3c2"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a></td></tr>
<tr class="memdesc:ac3715e08cbd719300a7d01c9633cb3c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag which describes if the current hall effect sampling period has concluded. <br /></td></tr>
<tr class="separator:ac3715e08cbd719300a7d01c9633cb3c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa80cb59482ff694d0bddd525d2c11d3"><td class="memItemLeft" align="right" valign="top"><a id="aaa80cb59482ff694d0bddd525d2c11d3"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#aaa80cb59482ff694d0bddd525d2c11d3">startUpLockOut</a></td></tr>
<tr class="memdesc:aaa80cb59482ff694d0bddd525d2c11d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag which determines if an engine startup will currently be prevented. <br /></td></tr>
<tr class="separator:aaa80cb59482ff694d0bddd525d2c11d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43cd4ea46756be50f1e3f31077e10444"><td class="memItemLeft" align="right" valign="top"><a id="a43cd4ea46756be50f1e3f31077e10444"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a43cd4ea46756be50f1e3f31077e10444">hallCount</a></td></tr>
<tr class="memdesc:a43cd4ea46756be50f1e3f31077e10444"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of pulses recorded in the current sampling period. <br /></td></tr>
<tr class="separator:a43cd4ea46756be50f1e3f31077e10444"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8b367a3ec51bcbf0a598e54edda7610"><td class="memItemLeft" align="right" valign="top"><a id="ac8b367a3ec51bcbf0a598e54edda7610"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#ac8b367a3ec51bcbf0a598e54edda7610">hasInterrupted</a></td></tr>
<tr class="memdesc:ac8b367a3ec51bcbf0a598e54edda7610"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag which describes whether the current data transmission has been interrupted by an ISR. <br /></td></tr>
<tr class="separator:ac8b367a3ec51bcbf0a598e54edda7610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba273f85164d91be7ba0341e7339bd29"><td class="memItemLeft" align="right" valign="top"><a id="aba273f85164d91be7ba0341e7339bd29"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#aba273f85164d91be7ba0341e7339bd29">commandCode</a></td></tr>
<tr class="memdesc:aba273f85164d91be7ba0341e7339bd29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes which type of information the ESB is receiving from the ECU, either normal data or a command. <br /></td></tr>
<tr class="separator:aba273f85164d91be7ba0341e7339bd29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1919a262301a8b185641dbb16a48a6d2"><td class="memItemLeft" align="right" valign="top"><a id="a1919a262301a8b185641dbb16a48a6d2"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a1919a262301a8b185641dbb16a48a6d2">ECUreceiveCount</a></td></tr>
<tr class="memdesc:a1919a262301a8b185641dbb16a48a6d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Counter to keep track of the current index in a message received from the ECU. <br /></td></tr>
<tr class="separator:a1919a262301a8b185641dbb16a48a6d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4fe19cf3f989d0dc2f1d829fa2ef74d"><td class="memItemLeft" align="right" valign="top"><a id="aa4fe19cf3f989d0dc2f1d829fa2ef74d"></a>
unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#aa4fe19cf3f989d0dc2f1d829fa2ef74d">glowPlug</a></td></tr>
<tr class="memdesc:aa4fe19cf3f989d0dc2f1d829fa2ef74d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag for if the glow plug is on or off. <br /></td></tr>
<tr class="separator:aa4fe19cf3f989d0dc2f1d829fa2ef74d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af468793001ca08918b5208156c88de9d"><td class="memItemLeft" align="right" valign="top"><a id="af468793001ca08918b5208156c88de9d"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#af468793001ca08918b5208156c88de9d">desMFlow</a></td></tr>
<tr class="memdesc:af468793001ca08918b5208156c88de9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Value of the desired amount of fuel flow. <br /></td></tr>
<tr class="separator:af468793001ca08918b5208156c88de9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d33ec29c2398728e80d752eeced889e"><td class="memItemLeft" align="right" valign="top"><a id="a4d33ec29c2398728e80d752eeced889e"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a></td></tr>
<tr class="memdesc:a4d33ec29c2398728e80d752eeced889e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Value for how much voltage applied to the fuel pump corresponds to a single pulse from the flow meter. <br /></td></tr>
<tr class="separator:a4d33ec29c2398728e80d752eeced889e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e65b097da1a73a847fa30bbd88fd97c"><td class="memItemLeft" align="right" valign="top"><a id="a2e65b097da1a73a847fa30bbd88fd97c"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a></td></tr>
<tr class="memdesc:a2e65b097da1a73a847fa30bbd88fd97c"><td class="mdescLeft">&#160;</td><td class="mdescRight">The amount of pulses expected per each g/sec of fuel flow. <br /></td></tr>
<tr class="separator:a2e65b097da1a73a847fa30bbd88fd97c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad92ac04cf55739302a547e262c7ca67f"><td class="memItemLeft" align="right" valign="top"><a id="ad92ac04cf55739302a547e262c7ca67f"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#ad92ac04cf55739302a547e262c7ca67f">bat_voltage</a></td></tr>
<tr class="memdesc:ad92ac04cf55739302a547e262c7ca67f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Value of the current lipo battery voltage. <br /></td></tr>
<tr class="separator:ad92ac04cf55739302a547e262c7ca67f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a031e4aaa8e149fcb07d8c1ed044dd16a"><td class="memItemLeft" align="right" valign="top"><a id="a031e4aaa8e149fcb07d8c1ed044dd16a"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a> [14]</td></tr>
<tr class="memdesc:a031e4aaa8e149fcb07d8c1ed044dd16a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array for the message to send to the ECU. <br /></td></tr>
<tr class="separator:a031e4aaa8e149fcb07d8c1ed044dd16a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1919835a3ae3fbb06144a6d93c2e75b9"><td class="memItemLeft" align="right" valign="top"><a id="a1919835a3ae3fbb06144a6d93c2e75b9"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a1919835a3ae3fbb06144a6d93c2e75b9">ECUreceive</a> [7]</td></tr>
<tr class="memdesc:a1919835a3ae3fbb06144a6d93c2e75b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array for the message received from the ECU. <br /></td></tr>
<tr class="separator:a1919835a3ae3fbb06144a6d93c2e75b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa477a3c8d0b96834b0291a9be67f1e77"><td class="memItemLeft" align="right" valign="top"><a id="aa477a3c8d0b96834b0291a9be67f1e77"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a></td></tr>
<tr class="memdesc:aa477a3c8d0b96834b0291a9be67f1e77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current RPM of recorded by the hall effect sensor. <br /></td></tr>
<tr class="separator:aa477a3c8d0b96834b0291a9be67f1e77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c104e39ff60265f33e3325bf865ab5"><td class="memItemLeft" align="right" valign="top"><a id="a34c104e39ff60265f33e3325bf865ab5"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></td></tr>
<tr class="memdesc:a34c104e39ff60265f33e3325bf865ab5"><td class="mdescLeft">&#160;</td><td class="mdescRight">The current exhaust gas temperature. <br /></td></tr>
<tr class="separator:a34c104e39ff60265f33e3325bf865ab5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b77a5034593409ad5dbd4586fab93ca"><td class="memItemLeft" align="right" valign="top"><a id="a8b77a5034593409ad5dbd4586fab93ca"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#a8b77a5034593409ad5dbd4586fab93ca">ref_temp</a></td></tr>
<tr class="memdesc:a8b77a5034593409ad5dbd4586fab93ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ambient temperature recorded on the ESB. This is currently unimplemented. <br /></td></tr>
<tr class="separator:a8b77a5034593409ad5dbd4586fab93ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab29954c519f55503589a368e542e6637"><td class="memItemLeft" ><a id="ab29954c519f55503589a368e542e6637"></a>
union {</td></tr>
<tr class="memitem:acb607650af9713167c308f9121560425"><td class="memItemLeft" >
&#160;&#160;&#160;uint8_t&#160;&#160;&#160;<b>c</b> [4]</td></tr>
<tr class="separator:acb607650af9713167c308f9121560425"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af900396d7b72ff2a7002e8befe8cf8f1"><td class="memItemLeft" >
&#160;&#160;&#160;float&#160;&#160;&#160;<b>f</b></td></tr>
<tr class="separator:af900396d7b72ff2a7002e8befe8cf8f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab29954c519f55503589a368e542e6637"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a></td></tr>
<tr class="memdesc:ab29954c519f55503589a368e542e6637"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current value of mass flow. <br /></td></tr>
<tr class="separator:ab29954c519f55503589a368e542e6637"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Function prototypes, macros, constants, and global variables for ESB microcontroller. </p>
<dl class="section author"><dt>Author</dt><dd>Nick Moore </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 22, 2018 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000004">Bug:</a></b></dt><dd>No known bugs </dd></dl>

<p class="definition">Definition in file <a class="el" href="_e_s_b__funcs_8h_source.html">ESB_funcs.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3b034cb1d74b9addc7599bd6ea6bd0d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b034cb1d74b9addc7599bd6ea6bd0d9">&#9670;&nbsp;</a></span>bit_is_set</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bit_is_set</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">sfr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">bit&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(_SFR_BYTE(sfr) &amp; _BV(bit))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Simple function define for testing if the bit is set. </p>
<p>Description of the opModes: OpMode 1: An engine shutdown has been requested OpMode 2: An engine startup is in progress OpMode 3: An engine throttle adjustment is needed OpMode 4: The flow meter is being waited on so that the throttle can be adjusted again OpMode 5: The engine is in the cooling mode OpMode 6: The engine is doing nothing OpMode 7: Special Shutdown, the EGT is not working properly and so there cannot be a normal cooling mode OpMode 8: Engine is operating at the desired throttle, within the designated error tolerance OpMode 9: Fuel is not flowing when it should be flowing OpMode 10: Engine has reached idle OpMode 11: Messages sent from the ECU have failed the parity check OpMode 12: Engine Temperature limit has been reached, shutting down OpMode 13: RPM limit has been reached, shutting down </p>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8h_source.html#l00035">35</a> of file <a class="el" href="_e_s_b__funcs_8h_source.html">ESB_funcs.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aba7fa75d6dd6ebcdc6225282a798fcd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba7fa75d6dd6ebcdc6225282a798fcd2">&#9670;&nbsp;</a></span>assign_bit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assign_bit </td>
          <td>(</td>
          <td class="paramtype">volatile uint8_t *&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>bit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the specified bit to the specified value or does nothing if it already set to that. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sfr</td><td>Pointer to Special Function Register the bit is located in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bit</td><td>Denotes the bit which would like to be changed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>The value, either 1 or 0, that the user would like the bit to be after the function call. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8c_source.html#l00021">21</a> of file <a class="el" href="_e_s_b__funcs_8c_source.html">ESB_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> (val)      <span class="comment">// This is for if I want the value to be a 1</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        val = (val &lt;&lt; bit);</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        *sfr |= val;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">else</span>             <span class="comment">// This is for if I want the value to be a 0</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        val = ~(1 &lt;&lt; bit);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        *sfr &amp;= val;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    }</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a90b932ca406d71217e71949d18161eba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90b932ca406d71217e71949d18161eba">&#9670;&nbsp;</a></span>calculateParity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t calculateParity </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>message</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>start_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the parity bytes for a set of 6 bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Array of bytes which contains all the data to be sent to the ECU </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start_index</td><td>Starting index for the six bytes by which to calculate the parity byte </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint8_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00176">176</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_communication_8c_source.html#l00202">countOnes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// This will return the parity byte for a message made up of 6 sequential bytes, starting with start_index</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    uint8_t parity = 0;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// first need to get the number of high bits in the first three bytes in the set</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keyword">set</span> = 0; <span class="keyword">set</span> &lt; 2; <span class="keyword">set</span>++){</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i = 0; i &lt; 3; i++){</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            count += <a class="code" href="_communication_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a>(message[start_index + <span class="keyword">set</span>*3 + i]);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// now that I have the count for this set, I need to take the modulo</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        count = count % 16;   <span class="comment">// Modulo with 16 because I have 4 bits to play with</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        </div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// now add this into the parity byte</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        parity |= count &lt;&lt; (4 * <span class="keyword">set</span>);   <span class="comment">// this will make it so that bytes 0-2 will take up the LSB of the parity byte</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// now copy this byte into memory</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span> parity;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div><div class="ttc" id="_communication_8c_html_adb2fefa1023fbf227e5102e1ea3c9d4b"><div class="ttname"><a href="_communication_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a></div><div class="ttdeci">unsigned char countOnes(unsigned char byte)</div><div class="ttdoc">Counts the number of high bits in a given byte. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00202">Communication.c:202</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af9fb91c429d399f97b97f61cf8df4d70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9fb91c429d399f97b97f61cf8df4d70">&#9670;&nbsp;</a></span>checkParity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t checkParity </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function checks that the parity bytes sent by the ECU match what the ESB generates. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00220">220</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_communication_8c_source.html#l00176">calculateParity()</a>, and <a class="el" href="_e_s_b__funcs_8h_source.html#l00160">ECUreceive</a>.</p>
<div class="fragment"><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;{</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    uint8_t result = 0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    uint8_t parity1 = <a class="code" href="_communication_8c.html#a90b932ca406d71217e71949d18161eba">calculateParity</a>(<a class="code" href="_e_s_b__funcs_8h.html#a1919835a3ae3fbb06144a6d93c2e75b9">ECUreceive</a>, 0);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    uint8_t parity2 = <a class="code" href="_communication_8c.html#a90b932ca406d71217e71949d18161eba">calculateParity</a>(<a class="code" href="_e_s_b__funcs_8h.html#a1919835a3ae3fbb06144a6d93c2e75b9">ECUreceive</a>, 3);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    </div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (parity1 == <a class="code" href="_e_s_b__funcs_8h.html#a1919835a3ae3fbb06144a6d93c2e75b9">ECUreceive</a>[9] &amp;&amp; parity2 == <a class="code" href="_e_s_b__funcs_8h.html#a1919835a3ae3fbb06144a6d93c2e75b9">ECUreceive</a>[10]){</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        result = 1;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div><div class="ttc" id="_communication_8c_html_a90b932ca406d71217e71949d18161eba"><div class="ttname"><a href="_communication_8c.html#a90b932ca406d71217e71949d18161eba">calculateParity</a></div><div class="ttdeci">uint8_t calculateParity(uint8_t message[], uint8_t start_index)</div><div class="ttdoc">Calculates the parity bytes for a set of 6 bytes. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00176">Communication.c:176</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a1919835a3ae3fbb06144a6d93c2e75b9"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a1919835a3ae3fbb06144a6d93c2e75b9">ECUreceive</a></div><div class="ttdeci">uint8_t ECUreceive[7]</div><div class="ttdoc">Array for the message received from the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00160">ESB_funcs.h:160</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3bb63dcf5362454afa9c040947c372ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bb63dcf5362454afa9c040947c372ae">&#9670;&nbsp;</a></span>compressor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compressor </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the duty cycle for the starter motor such that the compressor safely reaches a desired RPM. </p>
<p>1) This function uses a proportional-derivative control law to quickly get to the desired RPM of 10,000 RPM The reason this RPM was chosen is because it was listed in one of the data sheets for the JetCat engine</p>
<p>2) This control law uses gain which have been estimated based on the desired rise time and such. However, these gains have not been tested at all and should not be trusted.</p>
<p>3) If would be recommend that instead of using a fixed value for the voltage that can be supplied to the motor (see pump_tot_V) <br />
 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00163">163</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;{</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// For this function, the PD control law needs to be implemented</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">//so that the engine gets to 10,000 RPM as quickly as possible</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">char</span> slope = 0;     <span class="comment">// this will be a linear slope for the current rate of change of RPM</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    </div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// first turn on the glow plug</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    OCR2A = 255 - ((uint8_t) (gVolts / pump_tot_V * 255.0));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// now turn on the prescalar</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    TCCR2B |= (1 &lt;&lt; CS22) | (1 &lt;&lt; CS20);   <span class="comment">// this is a prescalar of 1024</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#aa4fe19cf3f989d0dc2f1d829fa2ef74d">glowPlug</a> = 1;   <span class="comment">// so that the PC can also record that the glow plug is on</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// now turn on the starter motor</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    OCR0A = 255 - ((uint8_t) (sMotor / pump_tot_V * 255.0));</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    TCCR0B |= (1 &lt;&lt; CS02) | (1 &lt;&lt; CS00);    </div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    </div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">while</span> (!(hallEffect &lt; 10500 &amp;&amp; hallEffect &gt; 9500 &amp;&amp; slope &lt; 10 &amp;&amp; slope &gt; -10))</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// now need to find new voltage</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordtype">float</span> voltage = Kp*(<a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a> - 10000) + Kd*slope;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (voltage &gt; 6.0)               <span class="comment">// Cap the voltage at the maximum the motor is rated for</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            voltage = 6.0;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (voltage &lt; 0.0)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            voltage = 0.0;         <span class="comment">// some error checking to make sure that things to not get unbounded</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// now convert this into a duty cycle </span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordtype">float</span> duty = voltage / pump_tot_V;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        </div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// now change the duty cycle on the starter motor</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        OCR0A = 255 - ((uint8_t) (duty * 255.5));</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a> = 0;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        uint16_t hallPrev = <a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">// now wait for the next hall effect sensor measurement</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">while</span> (!<a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a>);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        </div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> == 1){  <span class="comment">// This means that a shutdown has been invoked</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        </div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// now calculate the new slope</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        slope = (hallPrev - <a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a>) / 0.25;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        </div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    </div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_ac3715e08cbd719300a7d01c9633cb3c2"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a></div><div class="ttdeci">uint8_t hallDone</div><div class="ttdoc">Flag which describes if the current hall effect sampling period has concluded. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00124">ESB_funcs.h:124</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aa477a3c8d0b96834b0291a9be67f1e77"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a></div><div class="ttdeci">uint16_t hallEffect</div><div class="ttdoc">Current RPM of recorded by the hall effect sensor. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00163">ESB_funcs.h:163</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aa4fe19cf3f989d0dc2f1d829fa2ef74d"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aa4fe19cf3f989d0dc2f1d829fa2ef74d">glowPlug</a></div><div class="ttdeci">unsigned char glowPlug</div><div class="ttdoc">Flag for if the glow plug is on or off. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00142">ESB_funcs.h:142</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a24cdf62b1d79063305146ff04981c16a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24cdf62b1d79063305146ff04981c16a">&#9670;&nbsp;</a></span>coolingMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void coolingMode </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shuts off the engine with the exception of the starter motor to force cool air through the engine. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00308">308</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_s_b__funcs_8h_source.html#l00166">EGT</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">// for this I will make sure that the starter motor receives 4V </span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// This will force cool air through the engine</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    </div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> &gt; 100){</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// first need to make sure that the PWM is working </span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        TCCR0A |= (1 &lt;&lt; WGM01) | (1 &lt;&lt; WGM00) | (1 &lt;&lt; COM0A0) | (1 &lt;&lt; COM0A1);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        TCCR0B |= (1 &lt;&lt; WGM02);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        OCR0A = (uint8_t) (255 - sMotor * 255.0 / pump_tot_V);             <span class="comment">// When combine with a prescalar of 1024, this will have a period of 0.016384 seconds    </span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    </div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="comment">// Now start with the proper duty cycle</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        TCCR0B |= (1 &lt;&lt; CS00) | (1 &lt;&lt; CS02);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">else</span>{    <span class="comment">// this means that the engine has cooled sufficiently</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        TCCR0A = 0;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        TCCR0B = 0;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, startPin, 0);   <span class="comment">// make sure the starter motor is turned off</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> = 6;   <span class="comment">// this means that the engine is just kind of chilling    </span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    </div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    </div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00021">ESB_funcs.c:21</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">The current exhaust gas temperature. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00166">ESB_funcs.h:166</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afa94fbe612c655551cc89eecee4aa8c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa94fbe612c655551cc89eecee4aa8c0">&#9670;&nbsp;</a></span>EGT_collect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EGT_collect </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Collects the temperature from the Exhaust Gas Thermocouple and then packages/send data to the ECU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8c_source.html#l00040">40</a> of file <a class="el" href="_e_s_b__funcs_8c_source.html">ESB_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Now loop through 4 bytes for the receive message</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    uint8_t tempString[2];</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    SSACTIVE;       <span class="comment">// drop the SS line for the CJC</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++){</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        tempString[i] = <a class="code" href="_e_s_b__funcs_8c.html#acc743b5d0a4916b1e4cef66e569811fe">SPI_Receive</a>();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    SSPASSIVE;       <span class="comment">// raise the SS line again since we are done</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// Now interpret this data string into an actual temperature</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aebf54b1b64a7ea55a7c392688cbdbae6">getTemp</a>(tempString);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            </div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Now package the message</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="_communication_8c.html#adeadb2e1fc786ce91bfbd2c1c4ac4513">package_message</a>();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="ttc" id="_communication_8c_html_adeadb2e1fc786ce91bfbd2c1c4ac4513"><div class="ttname"><a href="_communication_8c.html#adeadb2e1fc786ce91bfbd2c1c4ac4513">package_message</a></div><div class="ttdeci">void package_message(void)</div><div class="ttdoc">Packages the message to later be sent to the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00036">Communication.c:36</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8c_html_aebf54b1b64a7ea55a7c392688cbdbae6"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aebf54b1b64a7ea55a7c392688cbdbae6">getTemp</a></div><div class="ttdeci">void getTemp(uint8_t *tempString)</div><div class="ttdoc">Converts the bytes received from the CJC into a usable temperature. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00084">ESB_funcs.c:84</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8c_html_acc743b5d0a4916b1e4cef66e569811fe"><div class="ttname"><a href="_e_s_b__funcs_8c.html#acc743b5d0a4916b1e4cef66e569811fe">SPI_Receive</a></div><div class="ttdeci">uint8_t SPI_Receive(void)</div><div class="ttdoc">Performs the operations needed to communicate with the CJC via SPI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00063">ESB_funcs.c:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a973541bd9d7a03580e58b233eb35de06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a973541bd9d7a03580e58b233eb35de06">&#9670;&nbsp;</a></span>fuel_puffs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fuel_puffs </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Operates the fuel pump and fuel/lubrication solenoids such that ignition begins in the combustion chamber. </p>
<p>1) This function starts by first applying voltage so that there will be some fuel pressure on the back of the closed fuel and lubrication solenoids.</p>
<p>2) Then the solenoid will begin opening with a duty cycle of 5% and increase by 5% every iteration in the loop. Each iteration of the loop will occupy 0.25 secs of time. <br />
 3) The Lubrication solenoid will then be toggled at an interval as specified by lube_factor (see header file). This value corresponds to the factor by which the lubrication solenoid is slower than the fuel solenoid.</p>
<p>4) Once the exhaust gas temperature gets above 200C, then the starter motor and glow plug will turn off as it can be assumed that the ignition has been seeded.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00225">225</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// If the code has made it this far then the compressor is up to speed </span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// first I need to apply 2 volts of pressure with the fuel pump</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    OCR3B = ICR3 - (<span class="keywordtype">unsigned</span> int)(ICR3 * 2.0 / pump_tot_V);          <span class="comment">// This will set the duty cycle so that there is 2 volts received by the pump</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// now change the prescalar so the pump will turn on, prescalar of 8</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    TCCR3B |= (1 &lt;&lt; CS31);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    </div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// Now begin with increasing the duty cycle</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordtype">float</span> duty = 0.0;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    OCR1B = ICR1 - (<span class="keywordtype">unsigned</span> int)(ICR1 * duty);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// now turn on the fuel solenoid with a prescalar of 256</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    TCCR4B |= (1 &lt;&lt; CS42);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// NOTE: It would be beneficial to have the output line for the fuel solenoid tied to a PCINT pin (such as PB6) and then</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// toggle the lubrication solenoid through the use of an interrupt.  Becuase of this the actuation of the lubrication </span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// solenoid will be left unimplemented. </span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    </div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">while</span> (duty != 1)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="comment">// now wait for the new value of Hall effect and EGT, wait for 2 cycles so that 0.5 seconds will elapse</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a> = 0;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">while</span> (!<a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a> = 0;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">while</span> (!<a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        </div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> == 1)    <span class="comment">// This means that a shutdown has been invoked</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            </div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> &gt; 200) {  <span class="comment">// if true, turn off the starter motor and glow plug.  Do your own check to make sure that 200C is a good temp to turn this off at</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            TCCR2A = 0;      <span class="comment">// this will return the pin to its normal state</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            TCCR2B &amp;= 0xF8;  <span class="comment">// this will turn off the glow plug</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, glowPin, 0);   <span class="comment">// force the pin low</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            TCCR0A = 0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            TCCR0B &amp;= 0xF8;  <span class="comment">// this will turn off the starter motor</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, startPin, 0);    <span class="comment">// for the pin low</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        duty += 0.05;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        OCR4B = ICR4 - (<span class="keywordtype">unsigned</span> int)(ICR4 * duty);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a>.f)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> = 9;      <span class="comment">// This is the opMode for if the fuel is not flowing</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_ab29954c519f55503589a368e542e6637"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a></div><div class="ttdeci">union @0 massFlow</div><div class="ttdoc">Current value of mass flow. </div></div>
<div class="ttc" id="_e_s_b__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00021">ESB_funcs.c:21</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">The current exhaust gas temperature. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00166">ESB_funcs.h:166</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_ac3715e08cbd719300a7d01c9633cb3c2"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a></div><div class="ttdeci">uint8_t hallDone</div><div class="ttdoc">Flag which describes if the current hall effect sampling period has concluded. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00124">ESB_funcs.h:124</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aebf54b1b64a7ea55a7c392688cbdbae6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebf54b1b64a7ea55a7c392688cbdbae6">&#9670;&nbsp;</a></span>getTemp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getTemp </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>tempString</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts the bytes received from the CJC into a usable temperature. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tempString</td><td>Array of chars which contains all the data received by the CJC </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8c_source.html#l00084">84</a> of file <a class="el" href="_e_s_b__funcs_8c_source.html">ESB_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_s_b__funcs_8h_source.html#l00166">EGT</a>, and <a class="el" href="_e_s_b__funcs_8h_source.html#l00169">ref_temp</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// First check to see if there is a fault</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">if</span> (tempString[1] &amp; 0x04)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> = 0;               <span class="comment">// This means that the Thermocouple is open, check connection</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">else</span> {                     <span class="comment">// If it makes it to here then there are no faults</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordtype">int</span> val = (tempString[0] &lt;&lt; 5) | (tempString[1] &gt;&gt; 3);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> (!val)</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            val = 1;   <span class="comment">// set the value to this for anything that is less than 3</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> = ((float) val / 4095.0) * 1023.75;        <span class="comment">// Since the temperature is on the scale of 0-&gt;1023.75 and it has 12 bit resolution</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a8b77a5034593409ad5dbd4586fab93ca">ref_temp</a> = 0;                                  <span class="comment">// This is unimplemented at this time as the MAX6675 does not transmit the reference temperature</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">The current exhaust gas temperature. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00166">ESB_funcs.h:166</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a8b77a5034593409ad5dbd4586fab93ca"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a8b77a5034593409ad5dbd4586fab93ca">ref_temp</a></div><div class="ttdeci">float ref_temp</div><div class="ttdoc">Ambient temperature recorded on the ESB. This is currently unimplemented. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00169">ESB_funcs.h:169</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b71bd44c46c9be20f29250cacab8a6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b71bd44c46c9be20f29250cacab8a6b">&#9670;&nbsp;</a></span>heatSoaking()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void heatSoaking </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prevents interruptions from the operation of the engine so that the temperature of the combustion can will increase. </p>
<p>1) This function is pretty simple, it sets a timer for 15 seconds and hogs execution until the timer has completed. During this time, the throttle is not allowed to be changed.</p>
<p>2) If this step is completed then it can be said that the engine has reached idle*</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00282">282</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_s_b__funcs_8c_source.html#l00021">assign_bit()</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00039">bit_is_clear</a>, and <a class="el" href="_e_s_b__funcs_8h_source.html#l00118">opMode</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;{</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// during this time the starter motor will not be using its PWM, timer0 (8 bit)</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    TCCR0A = 0;    <span class="comment">// make this work as a normal timer</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    TCCR0B = 0;    <span class="comment">// reset everything to 0</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    </div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// Now figure out the prescalars</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    TCNT0 = 100;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TIMSK0, TOIE0, 0);  <span class="comment">// make sure there are not any overflow interrupts</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    TCCR0B |= (1 &lt;&lt; CS02) | (1 &lt;&lt; CS00);   <span class="comment">// have a prescalar of 1024 and starts the timer</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    </div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; 1500; i++){</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="_e_s_b__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(TIFR0,TOV0));</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TIFR0, TOV0, 1);    <span class="comment">// clear by writing a 1 to it</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        TCNT0 = 100;    <span class="comment">// This will have the timer run for 0.1 seconds</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// If it has made it to here then the engine has reached idle</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> = 10;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00021">ESB_funcs.c:21</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00039">ESB_funcs.h:39</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a23459ced73501cbafb717ca9cbb10ce7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23459ced73501cbafb717ca9cbb10ce7">&#9670;&nbsp;</a></span>Initial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Initial </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the microcontroller for its mainline execution. </p>
<p>This performs the following functions:</p>
<p>1) Initializes the PORT data directions. 0 for input and 1 for output</p>
<p>2) Initializes the ADC for use by EGT</p>
<p>3) Initializes the External Interrupt line for use by the Hall effect Sensor</p>
<p>4) Initializes the I2C communication with the on board temperature sensors</p>
<p>5) Initializes the SPI communication with the ECU</p>
<p>6) Enable a timer for use by the Hall effect sensor</p>
<p>7) Enable a timer to determine if ignition is taking too long</p>
<p>8) Enable global interrupts</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_initial__funcs_8c_source.html#l00037">37</a> of file <a class="el" href="_initial__funcs_8c_source.html">Initial_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// Now do port directions for the PWM outputs</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    DDRB |= (1 &lt;&lt; PB4) | (1 &lt;&lt; PB5) | (1 &lt;&lt; PB7);   <span class="comment">// This sets the output for the pump, starter motor, and solenoids</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    DDRE |= (1 &lt;&lt; PE4); </div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    </div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// The next things that need to be set are as follows</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// 1) Set Enable the correct port directions</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// 2) Enable SPI, Master operation, and the clock rate</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    DDRB = (1 &lt;&lt; MOSI) | (1 &lt;&lt; SCK) | (1 &lt;&lt; CJC_SS) | (0 &lt;&lt; MISO);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    SPCR = (1 &lt;&lt; SPE) | (1 &lt;&lt; MSTR) | (1 &lt;&lt; SPR0);   <span class="comment">// This will enable SPI mode 0 with a clock rate of Fosc/16</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    </div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// The CJC will be sampled at the end of the Hall Effect Sampling period</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// This will be used with the Hall effect sensor</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;DDRD, INT2, 0);              <span class="comment">// Configure the PD2 pin as an input so that it can receive the signals</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a43cd4ea46756be50f1e3f31077e10444">hallCount</a> = 0;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    EICRA = (1 &lt;&lt; ISC20) | (1 &lt;&lt; ISC21);     <span class="comment">// This will enable rising edge interrupts on INT2, see page 110 in datasheet</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    </div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    UBRR0 = 12;     <span class="comment">// With a 16 MHz clock this will make a baud rate of 76800 (error of 0.16%)</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// The next things that need to be set are as follows (reference page 220 in datasheet)</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// 1) Enable receive interrupts</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// 2) Enable receiver</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// 3) Enable transmitter</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    UCSR0B = (1 &lt;&lt; RXCIE0) | (1 &lt;&lt; RXEN0) | (1 &lt;&lt; TXEN0);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// Now set the framing information</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// I want the following things</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// 1) Asynchronous USART</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// 2) No Parity</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// 3) 1 Stop bit</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// 4) 8 bit character size</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    UCSR0C = (1 &lt;&lt; UCSZ01) | (1 &lt;&lt; UCSZ00);   <span class="comment">// Now the USART should be ready to receive</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            </div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// Now initialize the timer for both the ECU communication error checking</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    TCNT5 = ECU_timer_val;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    TIMSK5 = (1 &lt;&lt; TOIE5);     <span class="comment">// enable overflow interrupts on this mode of timer 5</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// This will be set to 0.25 seconds so there is a reasonable sampling period</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    TCNT4 = HallTime;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    TIMSK4 = (1 &lt;&lt; TOIE4);                 <span class="comment">// enable overflow interrupts for the Hall effect sensor timer</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a>(195);                           <span class="comment">// wait this portion of time so that the ECU comm and Hall effect interrupts are off phase</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    TCCR4B = (1 &lt;&lt; CS41) | (1 &lt;&lt; CS40);    <span class="comment">// start timer 4 with prescalar of 64</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a> = (1.0 / density) * K_factor * max_time / 1000;   <span class="comment">// this is the pulses expected per g/s in 0.25 sec</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a> = pump_m / <a class="code" href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a>;  </div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    sei();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#ac8b367a3ec51bcbf0a598e54edda7610">hasInterrupted</a> = 0;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#aba273f85164d91be7ba0341e7339bd29">commandCode</a> = 0;        <span class="comment">// This means that that the next received char is a new command</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a1919a262301a8b185641dbb16a48a6d2">ECUreceiveCount</a> = 0;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_ac8b367a3ec51bcbf0a598e54edda7610"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ac8b367a3ec51bcbf0a598e54edda7610">hasInterrupted</a></div><div class="ttdeci">uint8_t hasInterrupted</div><div class="ttdoc">Flag which describes whether the current data transmission has been interrupted by an ISR...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00133">ESB_funcs.h:133</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a2e65b097da1a73a847fa30bbd88fd97c"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a></div><div class="ttdeci">float pulse_flow</div><div class="ttdoc">The amount of pulses expected per each g/sec of fuel flow. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00151">ESB_funcs.h:151</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00021">ESB_funcs.c:21</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aba273f85164d91be7ba0341e7339bd29"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aba273f85164d91be7ba0341e7339bd29">commandCode</a></div><div class="ttdeci">uint8_t commandCode</div><div class="ttdoc">Describes which type of information the ESB is receiving from the ECU, either normal data or a comman...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00136">ESB_funcs.h:136</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a1919a262301a8b185641dbb16a48a6d2"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a1919a262301a8b185641dbb16a48a6d2">ECUreceiveCount</a></div><div class="ttdeci">uint8_t ECUreceiveCount</div><div class="ttdoc">Counter to keep track of the current index in a message received from the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00139">ESB_funcs.h:139</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a4d33ec29c2398728e80d752eeced889e"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a></div><div class="ttdeci">float V_per_pulse</div><div class="ttdoc">Value for how much voltage applied to the fuel pump corresponds to a single pulse from the flow meter...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00148">ESB_funcs.h:148</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a43cd4ea46756be50f1e3f31077e10444"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a43cd4ea46756be50f1e3f31077e10444">hallCount</a></div><div class="ttdeci">uint16_t hallCount</div><div class="ttdoc">The number of pulses recorded in the current sampling period. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00130">ESB_funcs.h:130</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8c_html_abfac85317b9c1522c7b5196d94e471bd"><div class="ttname"><a href="_e_s_b__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a></div><div class="ttdeci">void waitMS(uint16_t msec)</div><div class="ttdoc">Waits for a designated number of milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00166">ESB_funcs.c:166</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adeadb2e1fc786ce91bfbd2c1c4ac4513"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adeadb2e1fc786ce91bfbd2c1c4ac4513">&#9670;&nbsp;</a></span>package_message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void package_message </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Packages the message to later be sent to the ECU. </p>
<p>This function loads the message into the array and then calculates the corresponding parity bytes to append to the end of the array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00036">36</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_communication_8c_source.html#l00176">calculateParity()</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00157">ECUtransmit</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00166">EGT</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00142">glowPlug</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00124">hallDone</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00163">hallEffect</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00118">opMode</a>, and <a class="el" href="_e_s_b__funcs_8h_source.html#l00169">ref_temp</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a> = 34567;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> = 12345;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#aa4fe19cf3f989d0dc2f1d829fa2ef74d">glowPlug</a> = 1;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a8b77a5034593409ad5dbd4586fab93ca">ref_temp</a> = 23456;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    </div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a>[0] = <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    memcpy(<a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a> + 1, &amp;<a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a>, <span class="keyword">sizeof</span>(uint16_t));</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    memcpy(<a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a> + 3, &amp;<a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    memcpy(<a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a> + 7, &amp;<a class="code" href="_e_s_b__funcs_8h.html#aa4fe19cf3f989d0dc2f1d829fa2ef74d">glowPlug</a>, <span class="keyword">sizeof</span>(uint8_t));</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    memcpy(<a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a> + 8, &amp;<a class="code" href="_e_s_b__funcs_8h.html#a8b77a5034593409ad5dbd4586fab93ca">ref_temp</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a>[12] = <a class="code" href="_communication_8c.html#a90b932ca406d71217e71949d18161eba">calculateParity</a>(<a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a>, 0);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a>[13] = <a class="code" href="_communication_8c.html#a90b932ca406d71217e71949d18161eba">calculateParity</a>(<a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a>, 6);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a> = 0;                          <span class="comment">// reset this we have already used the new data</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">The current exhaust gas temperature. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00166">ESB_funcs.h:166</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_ac3715e08cbd719300a7d01c9633cb3c2"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ac3715e08cbd719300a7d01c9633cb3c2">hallDone</a></div><div class="ttdeci">uint8_t hallDone</div><div class="ttdoc">Flag which describes if the current hall effect sampling period has concluded. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00124">ESB_funcs.h:124</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aa477a3c8d0b96834b0291a9be67f1e77"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a></div><div class="ttdeci">uint16_t hallEffect</div><div class="ttdoc">Current RPM of recorded by the hall effect sensor. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00163">ESB_funcs.h:163</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a031e4aaa8e149fcb07d8c1ed044dd16a"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a></div><div class="ttdeci">uint8_t ECUtransmit[14]</div><div class="ttdoc">Array for the message to send to the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00157">ESB_funcs.h:157</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a8b77a5034593409ad5dbd4586fab93ca"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a8b77a5034593409ad5dbd4586fab93ca">ref_temp</a></div><div class="ttdeci">float ref_temp</div><div class="ttdoc">Ambient temperature recorded on the ESB. This is currently unimplemented. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00169">ESB_funcs.h:169</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aa4fe19cf3f989d0dc2f1d829fa2ef74d"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aa4fe19cf3f989d0dc2f1d829fa2ef74d">glowPlug</a></div><div class="ttdeci">unsigned char glowPlug</div><div class="ttdoc">Flag for if the glow plug is on or off. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00142">ESB_funcs.h:142</a></div></div>
<div class="ttc" id="_communication_8c_html_a90b932ca406d71217e71949d18161eba"><div class="ttname"><a href="_communication_8c.html#a90b932ca406d71217e71949d18161eba">calculateParity</a></div><div class="ttdeci">uint8_t calculateParity(uint8_t message[], uint8_t start_index)</div><div class="ttdoc">Calculates the parity bytes for a set of 6 bytes. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00176">Communication.c:176</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5f55e4fd918cddf02226290d77ac2044"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f55e4fd918cddf02226290d77ac2044">&#9670;&nbsp;</a></span>sendToECU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendToECU </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Routine to send a number of bytes to the ECU over RS232. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>The number of bytes from ECUtransmit to send to the ECU </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00157">157</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_e_s_b__funcs_8h_source.html#l00157">ECUtransmit</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// this will send the number of character in ESBmessage up to len</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    cli();</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">for</span>(uint8_t i = 0; i &lt; len; i++)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">while</span> ( !( UCSR0A &amp; (1&lt;&lt;UDRE0)) );</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">/* Put data into buffer, sends the data */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        UDR0 = <a class="code" href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a>[i];</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    sei();</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_a031e4aaa8e149fcb07d8c1ed044dd16a"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a031e4aaa8e149fcb07d8c1ed044dd16a">ECUtransmit</a></div><div class="ttdeci">uint8_t ECUtransmit[14]</div><div class="ttdoc">Array for the message to send to the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00157">ESB_funcs.h:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a154a9f374d6a56c8d416a756891cc60e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a154a9f374d6a56c8d416a756891cc60e">&#9670;&nbsp;</a></span>setPWM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setPWM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets all of the Initializations for the PWMs for the Fuel Pump, Solenoids, and Starter Motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8c_source.html#l00136">136</a> of file <a class="el" href="_e_s_b__funcs_8c_source.html">ESB_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// First the Fuel pump will be a PWM on Timer 3</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    TCCR3A |= (1 &lt;&lt; WGM31);    <span class="comment">// set this for mode 14 waveform</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    TCCR3B |= (1 &lt;&lt; WGM32) | (1 &lt;&lt; WGM33);        <span class="comment">// this sets the other 2 bits for the waveform generation</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    TCCR3A |= (1 &lt;&lt; COM3B1) | (1 &lt;&lt; COM3B0);      <span class="comment">// This sets the other two bits for the waveform generation</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    ICR3 = 40000;                                 <span class="comment">// With a prescalar of 8, this will have a period of 20 ms</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    </div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// Now the fuel solenoid will be a PWM on Timer 1</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    TCCR1A |= (1 &lt;&lt; WGM11);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    TCCR1B |= (1 &lt;&lt; WGM12) | (1 &lt;&lt; WGM13);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    TCCR1A |= (1 &lt;&lt; COM1B1) | (1 &lt;&lt; COM1B0);      <span class="comment">// This is the same as for the fuel pump</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    ICR1 = 31250;                                 <span class="comment">// With a prescalar of 256, this will have a period of 0.5 sec</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// Now set up the Starter motor on Timer 0 (this an 8 bit timer instead of 16)</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    TCCR0A |= (1 &lt;&lt; WGM01) | (1 &lt;&lt; WGM00) | (1 &lt;&lt; COM0A0) | (1 &lt;&lt; COM0A1);   <span class="comment">// This will set it to the Fast PWM</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    TCCR0B |= (1 &lt;&lt; WGM02);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    OCR0A = (uint8_t) (255 - sMotor * 255.0 / pump_tot_V);             <span class="comment">// When combine with a prescalar of 1024, this will have a period of 0.016384 seconds</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    </div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// Now set up the Glow plug on Timer 2 (this is an 8 bit timer instead of 16)</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    TCCR2A |= (1 &lt;&lt; WGM21) | (1 &lt;&lt; WGM20) | (1 &lt;&lt; COM2A0) | (1 &lt;&lt; COM2A1);    <span class="comment">// This is the same as for starter motor code</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    TCCR2B |= (1 &lt;&lt; WGM22);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    OCR2A = (uint8_t) (255 - gVolts * 255.0 / pump_tot_V);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a1c9d5e29ad8899afe0c34571ddee18f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c9d5e29ad8899afe0c34571ddee18f9">&#9670;&nbsp;</a></span>shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void shutdown </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forces an engine shutdown and closes all output ports which could actuate the engine. </p>
<p>This function performs the following functions: 1) Zeros out the prescalars for the operation of the following pieces of hardware: a) The starter motor b) The fuel solenoid b) The glow plug c) The fuel pump d) The lubrication solenoid</p>
<p>2) Zeros out the control registers for the same components. This has the effect of restoring the pin to its normal operation (see page 155 in datasheet)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00029">29</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_s_b__funcs_8c_source.html#l00021">assign_bit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// For this just need to turn off the pump, glow plug, starter motor, and solenoids</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// Start with the starter motor</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    TCCR0B = 0;    <span class="comment">// this will force the prescalar values to be zero</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    TCCR0A = 0;    <span class="comment">// This will force normal operation of the pin (so that it can always be pulled low)</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, startPin, 0);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// Now the glow plug</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    TCCR2B = 0;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    TCCR2A = 0;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, glowPin, 0);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// now the pump</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    TCCR3B = 0;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    TCCR3A = 0;  <span class="comment">// make sure the PWM loses authority</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, pumpPin, 0);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// now the fuel solenoid</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    TCCR5B = 0;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    TCCR5A = 0;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, solePin, 0);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    </div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// now the lube solenoid</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, lubePin, 0);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#aaa80cb59482ff694d0bddd525d2c11d3">startUpLockOut</a> = 1;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> = 4;    <span class="comment">// An opMode of 4 means that the engine will enter the cooling mode</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00021">ESB_funcs.c:21</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aaa80cb59482ff694d0bddd525d2c11d3"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aaa80cb59482ff694d0bddd525d2c11d3">startUpLockOut</a></div><div class="ttdeci">uint8_t startUpLockOut</div><div class="ttdoc">Flag which determines if an engine startup will currently be prevented. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00127">ESB_funcs.h:127</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc743b5d0a4916b1e4cef66e569811fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc743b5d0a4916b1e4cef66e569811fe">&#9670;&nbsp;</a></span>SPI_Receive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SPI_Receive </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the operations needed to communicate with the CJC via SPI. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint8_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8c_source.html#l00063">63</a> of file <a class="el" href="_e_s_b__funcs_8c_source.html">ESB_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    cli();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">/* Put data into buffer and start the transmission */</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    SPDR = 0;   <span class="comment">// Since the CJC doesn&#39;t receive, we can put anything we want into the buffer</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    </div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* Wait for data to be received */</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">while</span> ( !(SPSR &amp; (1&lt;&lt;SPIF)) );</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    </div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">/* Enable interrupts again */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    sei();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    </div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">/* Get and return received data from buffer */</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">return</span> SPDR;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ab0c801cf89f8b3058ff2460c666154c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0c801cf89f8b3058ff2460c666154c3">&#9670;&nbsp;</a></span>startup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void startup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the function calls in order such that and engine startup would occur. </p>
<p>1) This function checks to make sure that there is not a lockout which prevents the engine from starting. These engine lockouts are put in place such that the engine cannot be started until it has fully stopped. This is to prevent a startup in an unsafe situation.</p>
<p>2) If a lockout is not present then the next set is set the various PWM lines such that the designates I/O pins can drive the hardware vital to the engine.</p>
<p>3) The function invokes the compressor function which will begin spinning up the starter motor until it reaches the point at which the air is sufficiently compressed for combustion to occur. Meanwhile, the glow plug is turned on so that it can begin heating up.</p>
<p>4) The function begins injecting small puffs of fuel into the combustion chamber so that combustion will begin taking place and become self-sufficient.</p>
<p>5) Assuming there are no issues with the engine operation so far, a heat soaking procedure will then take place. This is essentially a process where the engine is just allowed to run without being interfered with so that the combustion chamber can reach a more optimal temperature.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00082">82</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_engine__funcs_8c_source.html#l00163">compressor()</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00166">EGT</a>, <a class="el" href="_engine__funcs_8c_source.html#l00225">fuel_puffs()</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00163">hallEffect</a>, <a class="el" href="_engine__funcs_8c_source.html#l00282">heatSoaking()</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00118">opMode</a>, <a class="el" href="_e_s_b__funcs_8c_source.html#l00136">setPWM()</a>, <a class="el" href="_engine__funcs_8c_source.html#l00029">shutdown()</a>, <a class="el" href="_engine__funcs_8c_source.html#l00082">startup()</a>, and <a class="el" href="_e_s_b__funcs_8h_source.html#l00127">startUpLockOut</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#aaa80cb59482ff694d0bddd525d2c11d3">startUpLockOut</a>){</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a> &lt; 10 &amp;&amp; <a class="code" href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> &lt; 50){</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <a class="code" href="_e_s_b__funcs_8h.html#aaa80cb59482ff694d0bddd525d2c11d3">startUpLockOut</a> = 0;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <a class="code" href="_engine__funcs_8c.html#ab0c801cf89f8b3058ff2460c666154c3">startup</a>();              <span class="comment">// restart the function so that it has the opportunity to restart</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="_e_s_b__funcs_8c.html#a154a9f374d6a56c8d416a756891cc60e">setPWM</a>();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="_engine__funcs_8c.html#a3bb63dcf5362454afa9c040947c372ae">compressor</a>();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> == 1)</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <a class="code" href="_engine__funcs_8c.html#a973541bd9d7a03580e58b233eb35de06">fuel_puffs</a>();</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> == 1)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a> &lt; 35000){  <span class="comment">// This means that start up was not achieved</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <a class="code" href="_engine__funcs_8c.html#a1c9d5e29ad8899afe0c34571ddee18f9">shutdown</a>();     <span class="comment">// 35,000 RPM is the minimum required for startup</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">else</span>{</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <a class="code" href="_engine__funcs_8c.html#a7b71bd44c46c9be20f29250cacab8a6b">heatSoaking</a>();  </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">The current exhaust gas temperature. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00166">ESB_funcs.h:166</a></div></div>
<div class="ttc" id="_engine__funcs_8c_html_ab0c801cf89f8b3058ff2460c666154c3"><div class="ttname"><a href="_engine__funcs_8c.html#ab0c801cf89f8b3058ff2460c666154c3">startup</a></div><div class="ttdeci">void startup(void)</div><div class="ttdoc">Performs the function calls in order such that and engine startup would occur. </div><div class="ttdef"><b>Definition:</b> <a href="_engine__funcs_8c_source.html#l00082">Engine_funcs.c:82</a></div></div>
<div class="ttc" id="_engine__funcs_8c_html_a973541bd9d7a03580e58b233eb35de06"><div class="ttname"><a href="_engine__funcs_8c.html#a973541bd9d7a03580e58b233eb35de06">fuel_puffs</a></div><div class="ttdeci">void fuel_puffs(void)</div><div class="ttdoc">Operates the fuel pump and fuel/lubrication solenoids such that ignition begins in the combustion cha...</div><div class="ttdef"><b>Definition:</b> <a href="_engine__funcs_8c_source.html#l00225">Engine_funcs.c:225</a></div></div>
<div class="ttc" id="_engine__funcs_8c_html_a7b71bd44c46c9be20f29250cacab8a6b"><div class="ttname"><a href="_engine__funcs_8c.html#a7b71bd44c46c9be20f29250cacab8a6b">heatSoaking</a></div><div class="ttdeci">void heatSoaking(void)</div><div class="ttdoc">Prevents interruptions from the operation of the engine so that the temperature of the combustion can...</div><div class="ttdef"><b>Definition:</b> <a href="_engine__funcs_8c_source.html#l00282">Engine_funcs.c:282</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
<div class="ttc" id="_engine__funcs_8c_html_a1c9d5e29ad8899afe0c34571ddee18f9"><div class="ttname"><a href="_engine__funcs_8c.html#a1c9d5e29ad8899afe0c34571ddee18f9">shutdown</a></div><div class="ttdeci">void shutdown(void)</div><div class="ttdoc">Forces an engine shutdown and closes all output ports which could actuate the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_engine__funcs_8c_source.html#l00029">Engine_funcs.c:29</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aa477a3c8d0b96834b0291a9be67f1e77"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aa477a3c8d0b96834b0291a9be67f1e77">hallEffect</a></div><div class="ttdeci">uint16_t hallEffect</div><div class="ttdoc">Current RPM of recorded by the hall effect sensor. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00163">ESB_funcs.h:163</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8c_html_a154a9f374d6a56c8d416a756891cc60e"><div class="ttname"><a href="_e_s_b__funcs_8c.html#a154a9f374d6a56c8d416a756891cc60e">setPWM</a></div><div class="ttdeci">void setPWM(void)</div><div class="ttdoc">Sets all of the Initializations for the PWMs for the Fuel Pump, Solenoids, and Starter Motor...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00136">ESB_funcs.c:136</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_aaa80cb59482ff694d0bddd525d2c11d3"><div class="ttname"><a href="_e_s_b__funcs_8h.html#aaa80cb59482ff694d0bddd525d2c11d3">startUpLockOut</a></div><div class="ttdeci">uint8_t startUpLockOut</div><div class="ttdoc">Flag which determines if an engine startup will currently be prevented. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00127">ESB_funcs.h:127</a></div></div>
<div class="ttc" id="_engine__funcs_8c_html_a3bb63dcf5362454afa9c040947c372ae"><div class="ttname"><a href="_engine__funcs_8c.html#a3bb63dcf5362454afa9c040947c372ae">compressor</a></div><div class="ttdeci">void compressor(void)</div><div class="ttdoc">Sets the duty cycle for the starter motor such that the compressor safely reaches a desired RPM...</div><div class="ttdef"><b>Definition:</b> <a href="_engine__funcs_8c_source.html#l00163">Engine_funcs.c:163</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a54163ad9d4f9e7fa08b4aae836a1b316"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54163ad9d4f9e7fa08b4aae836a1b316">&#9670;&nbsp;</a></span>throttle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void throttle </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the fuel flow rate such that the engine would operate at a desired throttle value. </p>
<p>1) This function converts the desired throttle value into a mass flow rate. THIS MASS FLOW RATE IS DETERMINED ONLY FOR THE P90-RXI!</p>
<p>2) This mass flow rate is then converted into a number of flow rate pulses bases on the known linear relationship. See the published document for more explanation on this relationship.</p>
<p>3) The error, in terms of pulses, is then determined between the actual and desired flow rate of fuel.</p>
<p>4) The error is then converted into volts, which then can be used to directly translated into how many counts by which the input capture control register. This directly correlates to the duty cycle for the PWM signal which powers the fuel pump.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00126">126</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_s_b__funcs_8h_source.html#l00145">desMFlow</a>, <a class="el" href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a>, <a class="el" href="_e_s_b__funcs_8h_source.html#l00151">pulse_flow</a>, and <a class="el" href="_e_s_b__funcs_8h_source.html#l00121">throttle_val</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// first I need to figure out what mass flow rate is desired for the requested throttle</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="_e_s_b__funcs_8h.html#af468793001ca08918b5208156c88de9d">desMFlow</a> = 4.8*((float) <a class="code" href="_e_s_b__funcs_8h.html#a715738e95d6e1917be2e5d209d416ff2">throttle_val</a> / 255.0);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    uint8_t desPulses = (uint8_t) <a class="code" href="_e_s_b__funcs_8h.html#af468793001ca08918b5208156c88de9d">desMFlow</a>*<a class="code" href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    </div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// Now I need to increase the duty cycle depending in the difference from the expected flow rate</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    uint8_t pulse_error = desPulses - (uint8_t) <a class="code" href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a> * <a class="code" href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a>.f;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    </div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">float</span> difference = <a class="code" href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a>.f - <a class="code" href="_e_s_b__funcs_8h.html#af468793001ca08918b5208156c88de9d">desMFlow</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    if (difference &lt; 0)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        difference = -difference;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    </div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span> (difference &lt; errorAllow){</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> = 8;                                 <span class="comment">// this means that the desired throttle has been reached</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    </div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">float</span> change = (float) pulse_error * <a class="code" href="_e_s_b__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a> * ((<span class="keywordtype">float</span>) ICR3 / pump_tot_V);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    OCR3B -= (uint16_t) change;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> != 8)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a> = 4;                 <span class="comment">// change the opMode so that it doesn&#39;t go through this again until there is a new flow measurement</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8h_html_ab29954c519f55503589a368e542e6637"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ab29954c519f55503589a368e542e6637">massFlow</a></div><div class="ttdeci">union @0 massFlow</div><div class="ttdoc">Current value of mass flow. </div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a2e65b097da1a73a847fa30bbd88fd97c"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a2e65b097da1a73a847fa30bbd88fd97c">pulse_flow</a></div><div class="ttdeci">float pulse_flow</div><div class="ttdoc">The amount of pulses expected per each g/sec of fuel flow. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00151">ESB_funcs.h:151</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a07a924cfb101a7d1ce3489f00b9da976"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a07a924cfb101a7d1ce3489f00b9da976">opMode</a></div><div class="ttdeci">uint8_t opMode</div><div class="ttdoc">Describes critical information about the current state of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00118">ESB_funcs.h:118</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_af468793001ca08918b5208156c88de9d"><div class="ttname"><a href="_e_s_b__funcs_8h.html#af468793001ca08918b5208156c88de9d">desMFlow</a></div><div class="ttdeci">float desMFlow</div><div class="ttdoc">Value of the desired amount of fuel flow. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00145">ESB_funcs.h:145</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a4d33ec29c2398728e80d752eeced889e"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a></div><div class="ttdeci">float V_per_pulse</div><div class="ttdoc">Value for how much voltage applied to the fuel pump corresponds to a single pulse from the flow meter...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00148">ESB_funcs.h:148</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_a715738e95d6e1917be2e5d209d416ff2"><div class="ttname"><a href="_e_s_b__funcs_8h.html#a715738e95d6e1917be2e5d209d416ff2">throttle_val</a></div><div class="ttdeci">uint8_t throttle_val</div><div class="ttdoc">Value 1-100 for the the user wants to set the throttle to. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00121">ESB_funcs.h:121</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abfac85317b9c1522c7b5196d94e471bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfac85317b9c1522c7b5196d94e471bd">&#9670;&nbsp;</a></span>waitMS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void waitMS </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>msec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Waits for a designated number of milliseconds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msec</td><td>Value of milliseconds that are wanting to be waited for </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Waits for a designated number of milliseconds.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msec</td><td>Number of milliseconds that are desired to be delayed for </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_s_b__funcs_8c_source.html#l00166">166</a> of file <a class="el" href="_e_s_b__funcs_8c_source.html">ESB_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// This function utilizes timer 0 and a sequence of delay loops to delay for the desired time</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    TCNT0 = 5;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// begin the timer</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    TCCR0B |= (1 &lt;&lt; CS01) | (1 &lt;&lt; CS00);       <span class="comment">// this will start the timer with a prescalar of 64</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; msec; i++){</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">while</span>(<a class="code" href="_e_s_b__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(TIFR0, TOV0));</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        TIFR0 |= (1 &lt;&lt; TOV0);                  <span class="comment">// Clear the overflow flag by writing a 1 to it</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0B, CS01, 0);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0B, CS00, 0);              <span class="comment">// Turn off the timer</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div><div class="ttc" id="_e_s_b__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_s_b__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8c_source.html#l00021">ESB_funcs.c:21</a></div></div>
<div class="ttc" id="_e_s_b__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_s_b__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_s_b__funcs_8h_source.html#l00039">ESB_funcs.h:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
