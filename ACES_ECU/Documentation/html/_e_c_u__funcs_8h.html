<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACES ECU: C:/Users/nickm/Documents/GitHub/ACES_ECU/ACES_ECU/ECU_funcs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACES ECU
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Software Implementation of Team ACES ECU</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">C:/Users/nickm/Documents/GitHub/ACES_ECU/ACES_ECU/ECU_funcs.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Function prototypes, macros, constants, and global variables for ECU microcontroller.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;avr/sfr_defs.h&gt;</code><br />
<code>#include &lt;float.h&gt;</code><br />
</div>
<p><a href="_e_c_u__funcs_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3b034cb1d74b9addc7599bd6ea6bd0d9"><td class="memItemLeft" align="right" valign="top"><a id="a3b034cb1d74b9addc7599bd6ea6bd0d9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a3b034cb1d74b9addc7599bd6ea6bd0d9">bit_is_set</a>(sfr,  bit)&#160;&#160;&#160;(_SFR_BYTE(sfr) &amp; _BV(bit))</td></tr>
<tr class="memdesc:a3b034cb1d74b9addc7599bd6ea6bd0d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple function define for testing if the bit is set. <br /></td></tr>
<tr class="separator:a3b034cb1d74b9addc7599bd6ea6bd0d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad188fb0fbfd923bdb01294072367d024"><td class="memItemLeft" align="right" valign="top"><a id="ad188fb0fbfd923bdb01294072367d024"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(sfr,  bit)&#160;&#160;&#160;(!(_SFR_BYTE(sfr) &amp; _BV(bit)))</td></tr>
<tr class="memdesc:ad188fb0fbfd923bdb01294072367d024"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple function define for testing if the bit is clear. <br /></td></tr>
<tr class="separator:ad188fb0fbfd923bdb01294072367d024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a621ae94764567a61b20de29cf0a367f3"><td class="memItemLeft" align="right" valign="top"><a id="a621ae94764567a61b20de29cf0a367f3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ECU_temp_sensors</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a621ae94764567a61b20de29cf0a367f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e20970ac4e6bc924ea5e6073b820d26"><td class="memItemLeft" align="right" valign="top"><a id="a5e20970ac4e6bc924ea5e6073b820d26"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ESB_temp_sensors</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a5e20970ac4e6bc924ea5e6073b820d26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a062607eaaffe8c3f8193991755e024f9"><td class="memItemLeft" align="right" valign="top"><a id="a062607eaaffe8c3f8193991755e024f9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a062607eaaffe8c3f8193991755e024f9">K_factor</a>&#160;&#160;&#160;91387</td></tr>
<tr class="memdesc:a062607eaaffe8c3f8193991755e024f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Assumed K factor for the flow meter in pulses per liter. <br /></td></tr>
<tr class="separator:a062607eaaffe8c3f8193991755e024f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a959f7b5d831006ba86ebf2754975fdfc"><td class="memItemLeft" align="right" valign="top"><a id="a959f7b5d831006ba86ebf2754975fdfc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a959f7b5d831006ba86ebf2754975fdfc">density</a>&#160;&#160;&#160;0.81</td></tr>
<tr class="memdesc:a959f7b5d831006ba86ebf2754975fdfc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Density of the kerosene in g/ml. <br /></td></tr>
<tr class="separator:a959f7b5d831006ba86ebf2754975fdfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f29307316da99a662028868a7f7636d"><td class="memItemLeft" align="right" valign="top"><a id="a0f29307316da99a662028868a7f7636d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a0f29307316da99a662028868a7f7636d">max_time</a>&#160;&#160;&#160;0.25</td></tr>
<tr class="memdesc:a0f29307316da99a662028868a7f7636d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum amount of time for an 8 bit timer with a prescalar of 1024. <br /></td></tr>
<tr class="separator:a0f29307316da99a662028868a7f7636d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f24004cae5e9f858db493e25febf8c8"><td class="memItemLeft" align="right" valign="top"><a id="a8f24004cae5e9f858db493e25febf8c8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a8f24004cae5e9f858db493e25febf8c8">pump_m</a>&#160;&#160;&#160;0.382587</td></tr>
<tr class="memdesc:a8f24004cae5e9f858db493e25febf8c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Slope for the linear relationship between voltage and mass flow (put in mf, get volts) <br /></td></tr>
<tr class="separator:a8f24004cae5e9f858db493e25febf8c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a355b9fced824741eba5498a7bc74371e"><td class="memItemLeft" align="right" valign="top"><a id="a355b9fced824741eba5498a7bc74371e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a355b9fced824741eba5498a7bc74371e">pump_b</a>&#160;&#160;&#160;0.195783</td></tr>
<tr class="memdesc:a355b9fced824741eba5498a7bc74371e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Y-intercept for the linear relationship between voltage and mass flow. <br /></td></tr>
<tr class="separator:a355b9fced824741eba5498a7bc74371e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5faa2a8a3cb2e4b3261a182fa2e83251"><td class="memItemLeft" align="right" valign="top"><a id="a5faa2a8a3cb2e4b3261a182fa2e83251"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a5faa2a8a3cb2e4b3261a182fa2e83251">HCU_present</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:a5faa2a8a3cb2e4b3261a182fa2e83251"><td class="mdescLeft">&#160;</td><td class="mdescRight">defines if the HCU is present in the current configuration or not, 1 for yes, 0 for no <br /></td></tr>
<tr class="separator:a5faa2a8a3cb2e4b3261a182fa2e83251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eaf9196d649f839a674cfa4ad10cedc"><td class="memItemLeft" align="right" valign="top"><a id="a9eaf9196d649f839a674cfa4ad10cedc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a9eaf9196d649f839a674cfa4ad10cedc">maxRPM</a>&#160;&#160;&#160;60850</td></tr>
<tr class="memdesc:a9eaf9196d649f839a674cfa4ad10cedc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the maximum RPM of the engine. <br /></td></tr>
<tr class="separator:a9eaf9196d649f839a674cfa4ad10cedc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c1f67075d989a060a5fd5632e88707"><td class="memItemLeft" align="right" valign="top"><a id="a02c1f67075d989a060a5fd5632e88707"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a02c1f67075d989a060a5fd5632e88707">idleRPM</a>&#160;&#160;&#160;16384</td></tr>
<tr class="memdesc:a02c1f67075d989a060a5fd5632e88707"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the idle RPM of the engine. <br /></td></tr>
<tr class="separator:a02c1f67075d989a060a5fd5632e88707"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3df22e1e7b66be8b74b33ce077824292"><td class="memItemLeft" align="right" valign="top"><a id="a3df22e1e7b66be8b74b33ce077824292"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SLA_W</b>&#160;&#160;&#160;0x3E</td></tr>
<tr class="separator:a3df22e1e7b66be8b74b33ce077824292"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4af1f304be9d3202a445e7d6c235eaa"><td class="memItemLeft" align="right" valign="top"><a id="ae4af1f304be9d3202a445e7d6c235eaa"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SLA_R</b>&#160;&#160;&#160;0x3F</td></tr>
<tr class="separator:ae4af1f304be9d3202a445e7d6c235eaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e79eb2bec9cc994f749e94520dba5b"><td class="memItemLeft" align="right" valign="top"><a id="a74e79eb2bec9cc994f749e94520dba5b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>dec_MSK</b>&#160;&#160;&#160;0x0C</td></tr>
<tr class="separator:a74e79eb2bec9cc994f749e94520dba5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8112c985f7444e82198d7571ce0a9160"><td class="memItemLeft" align="right" valign="top"><a id="a8112c985f7444e82198d7571ce0a9160"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SPI_PORT</b>&#160;&#160;&#160;PORTB</td></tr>
<tr class="separator:a8112c985f7444e82198d7571ce0a9160"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abed35d9048e296d7781c7c85d1347214"><td class="memItemLeft" align="right" valign="top"><a id="abed35d9048e296d7781c7c85d1347214"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>normalData</b>&#160;&#160;&#160;11</td></tr>
<tr class="separator:abed35d9048e296d7781c7c85d1347214"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78dbbb8d5a9fbe59bf96ee4c5be96d4e"><td class="memItemLeft" align="right" valign="top"><a id="a78dbbb8d5a9fbe59bf96ee4c5be96d4e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ESB_timer_val</b>&#160;&#160;&#160;3036</td></tr>
<tr class="separator:a78dbbb8d5a9fbe59bf96ee4c5be96d4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa13614160d2709946793367a83e2b5cb"><td class="memItemLeft" align="right" valign="top"><a id="aa13614160d2709946793367a83e2b5cb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FlowTime</b>&#160;&#160;&#160;3700</td></tr>
<tr class="separator:aa13614160d2709946793367a83e2b5cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adadb83dbf93c641471da7d08630309da"><td class="memItemLeft" align="right" valign="top"><a id="adadb83dbf93c641471da7d08630309da"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>XCK1</b>&#160;&#160;&#160;5</td></tr>
<tr class="separator:adadb83dbf93c641471da7d08630309da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb59fbc9d7da71bc6b6abd1a275e54e1"><td class="memItemLeft" align="right" valign="top"><a id="abb59fbc9d7da71bc6b6abd1a275e54e1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>UCPHA1</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:abb59fbc9d7da71bc6b6abd1a275e54e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3bacb68e72ad3fba2c7b1b26a4cb130"><td class="memItemLeft" align="right" valign="top"><a id="ad3bacb68e72ad3fba2c7b1b26a4cb130"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ESB_SS</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ad3bacb68e72ad3fba2c7b1b26a4cb130"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5ee236ff60450d32c390fec0247266f"><td class="memItemLeft" align="right" valign="top"><a id="aa5ee236ff60450d32c390fec0247266f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HCU_link</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:aa5ee236ff60450d32c390fec0247266f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d3f11f2fdf8a7e27b975291e0c2c8cc"><td class="memItemLeft" align="right" valign="top"><a id="a5d3f11f2fdf8a7e27b975291e0c2c8cc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MOSI</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a5d3f11f2fdf8a7e27b975291e0c2c8cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dd443a4430713d325ab86895a4a45eb"><td class="memItemLeft" align="right" valign="top"><a id="a2dd443a4430713d325ab86895a4a45eb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SCK</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a2dd443a4430713d325ab86895a4a45eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a013b823a1365a9c8f46218f490f71b62"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a013b823a1365a9c8f46218f490f71b62">pre_Initial</a> (void)</td></tr>
<tr class="memdesc:a013b823a1365a9c8f46218f490f71b62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the waiting cycle until the HCU signals to the ECU to being operating.  <a href="#a013b823a1365a9c8f46218f490f71b62">More...</a><br /></td></tr>
<tr class="separator:a013b823a1365a9c8f46218f490f71b62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23459ced73501cbafb717ca9cbb10ce7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a23459ced73501cbafb717ca9cbb10ce7">Initial</a> (void)</td></tr>
<tr class="memdesc:a23459ced73501cbafb717ca9cbb10ce7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the microcontroller for its mainline execution.  <a href="#a23459ced73501cbafb717ca9cbb10ce7">More...</a><br /></td></tr>
<tr class="separator:a23459ced73501cbafb717ca9cbb10ce7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c9d5e29ad8899afe0c34571ddee18f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a1c9d5e29ad8899afe0c34571ddee18f9">shutdown</a> (void)</td></tr>
<tr class="memdesc:a1c9d5e29ad8899afe0c34571ddee18f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Commands the ESB to shutdown and awaits the confirmation code.  <a href="#a1c9d5e29ad8899afe0c34571ddee18f9">More...</a><br /></td></tr>
<tr class="separator:a1c9d5e29ad8899afe0c34571ddee18f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0c801cf89f8b3058ff2460c666154c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ab0c801cf89f8b3058ff2460c666154c3">startup</a> (void)</td></tr>
<tr class="memdesc:ab0c801cf89f8b3058ff2460c666154c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Commands the ESB to startup and awaits the confirmation code.  <a href="#ab0c801cf89f8b3058ff2460c666154c3">More...</a><br /></td></tr>
<tr class="separator:ab0c801cf89f8b3058ff2460c666154c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54163ad9d4f9e7fa08b4aae836a1b316"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a54163ad9d4f9e7fa08b4aae836a1b316">throttle</a> (void)</td></tr>
<tr class="memdesc:a54163ad9d4f9e7fa08b4aae836a1b316"><td class="mdescLeft">&#160;</td><td class="mdescRight">Commands the ESB to adjust the throttle and awaits the confirmation code.  <a href="#a54163ad9d4f9e7fa08b4aae836a1b316">More...</a><br /></td></tr>
<tr class="separator:a54163ad9d4f9e7fa08b4aae836a1b316"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dc66b4b2df662c440d4d05da08e6d6a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a9dc66b4b2df662c440d4d05da08e6d6a">batVoltage</a> (void)</td></tr>
<tr class="memdesc:a9dc66b4b2df662c440d4d05da08e6d6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measures the voltage on the Lipo battery from the 3 different ADC channels.  <a href="#a9dc66b4b2df662c440d4d05da08e6d6a">More...</a><br /></td></tr>
<tr class="separator:a9dc66b4b2df662c440d4d05da08e6d6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a> (volatile uint8_t *sfr, uint8_t bit, uint8_t val)</td></tr>
<tr class="memdesc:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the specified bit to the specified value or does nothing if it already set to that.  <a href="#aba7fa75d6dd6ebcdc6225282a798fcd2">More...</a><br /></td></tr>
<tr class="separator:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ad78c90a2e828201a614444385801c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a> (uint8_t len)</td></tr>
<tr class="memdesc:a9ad78c90a2e828201a614444385801c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transmits data between the ECU and ESB.  <a href="#a9ad78c90a2e828201a614444385801c7">More...</a><br /></td></tr>
<tr class="separator:a9ad78c90a2e828201a614444385801c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3590f927d6f0e270aad13cd890ba3d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#aa3590f927d6f0e270aad13cd890ba3d5">ESB_Connect</a> (void)</td></tr>
<tr class="memdesc:aa3590f927d6f0e270aad13cd890ba3d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Establishes the connection between the ECU and ESB.  <a href="#aa3590f927d6f0e270aad13cd890ba3d5">More...</a><br /></td></tr>
<tr class="separator:aa3590f927d6f0e270aad13cd890ba3d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61322b047675f61caefcfaca81cfa48b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a61322b047675f61caefcfaca81cfa48b">measureFlow</a> (void)</td></tr>
<tr class="memdesc:a61322b047675f61caefcfaca81cfa48b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measures the fuel flow passing through the Flow meter.  <a href="#a61322b047675f61caefcfaca81cfa48b">More...</a><br /></td></tr>
<tr class="separator:a61322b047675f61caefcfaca81cfa48b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebc6f692b7c3787a859445b96ab3ec5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#aebc6f692b7c3787a859445b96ab3ec5f">sendToLaptop</a> (void)</td></tr>
<tr class="memdesc:aebc6f692b7c3787a859445b96ab3ec5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transmits periodic data between the ECU and Windows GUI.  <a href="#aebc6f692b7c3787a859445b96ab3ec5f">More...</a><br /></td></tr>
<tr class="separator:aebc6f692b7c3787a859445b96ab3ec5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a285a2f8773a070acdcea234b60cf38ca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a285a2f8773a070acdcea234b60cf38ca">repeatCommand</a> (void)</td></tr>
<tr class="memdesc:a285a2f8773a070acdcea234b60cf38ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Requests the Windows GUI to repeat the last sent command.  <a href="#a285a2f8773a070acdcea234b60cf38ca">More...</a><br /></td></tr>
<tr class="separator:a285a2f8773a070acdcea234b60cf38ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada467eaa29152bd3a35afbf4d62e53fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ada467eaa29152bd3a35afbf4d62e53fd">GUI_Connect</a> (void)</td></tr>
<tr class="memdesc:ada467eaa29152bd3a35afbf4d62e53fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Establishes the connection between the ECU and Windows GUI.  <a href="#ada467eaa29152bd3a35afbf4d62e53fd">More...</a><br /></td></tr>
<tr class="separator:ada467eaa29152bd3a35afbf4d62e53fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae11da7e638c4141fa09c2b3748f713fd"><td class="memItemLeft" align="right" valign="top"><a id="ae11da7e638c4141fa09c2b3748f713fd"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>i2c_Start</b> (unsigned char address)</td></tr>
<tr class="separator:ae11da7e638c4141fa09c2b3748f713fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d7492476cf394bef5161e2a6503fc1e"><td class="memItemLeft" align="right" valign="top"><a id="a7d7492476cf394bef5161e2a6503fc1e"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>i2c_Stop</b> (void)</td></tr>
<tr class="separator:a7d7492476cf394bef5161e2a6503fc1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab00dbbd4d0d7c829374f726f66020bcc"><td class="memItemLeft" align="right" valign="top"><a id="ab00dbbd4d0d7c829374f726f66020bcc"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>i2c_write</b> (unsigned char data)</td></tr>
<tr class="separator:ab00dbbd4d0d7c829374f726f66020bcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a669c0357614a79b3b35ae815f6f50e82"><td class="memItemLeft" align="right" valign="top"><a id="a669c0357614a79b3b35ae815f6f50e82"></a>
unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>i2c_read</b> (unsigned char ack)</td></tr>
<tr class="separator:a669c0357614a79b3b35ae815f6f50e82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17727302d45ecff548af8f81d06f3a7e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a17727302d45ecff548af8f81d06f3a7e">readTempSensor</a> (void)</td></tr>
<tr class="memdesc:a17727302d45ecff548af8f81d06f3a7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accesses memory within the MAX6675 and converts the data into a usable temperature.  <a href="#a17727302d45ecff548af8f81d06f3a7e">More...</a><br /></td></tr>
<tr class="separator:a17727302d45ecff548af8f81d06f3a7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc85b180d655324bb96dcb29cff05af3"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a> (char message[], uint8_t start_index)</td></tr>
<tr class="memdesc:adc85b180d655324bb96dcb29cff05af3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to calculate the parity byte for a corresponding sequence of 6 bytes.  <a href="#adc85b180d655324bb96dcb29cff05af3">More...</a><br /></td></tr>
<tr class="separator:adc85b180d655324bb96dcb29cff05af3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb2fefa1023fbf227e5102e1ea3c9d4b"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a> (unsigned char byte)</td></tr>
<tr class="memdesc:adb2fefa1023fbf227e5102e1ea3c9d4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine to count the number of high bits within a designated byte.  <a href="#adb2fefa1023fbf227e5102e1ea3c9d4b">More...</a><br /></td></tr>
<tr class="separator:adb2fefa1023fbf227e5102e1ea3c9d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae173d68280445c6d2838fe28f007ebaf"><td class="memItemLeft" align="right" valign="top"><a id="ae173d68280445c6d2838fe28f007ebaf"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>packageMessage</b> (void)</td></tr>
<tr class="separator:ae173d68280445c6d2838fe28f007ebaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfac85317b9c1522c7b5196d94e471bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a> (uint16_t msec)</td></tr>
<tr class="memdesc:abfac85317b9c1522c7b5196d94e471bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine which will wait for a given number of milliseconds.  <a href="#abfac85317b9c1522c7b5196d94e471bd">More...</a><br /></td></tr>
<tr class="separator:abfac85317b9c1522c7b5196d94e471bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa161ecc9fae4c6dbf5ef7063d777d1d"><td class="memItemLeft" align="right" valign="top"><a id="afa161ecc9fae4c6dbf5ef7063d777d1d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>loadESBData</b> (void)</td></tr>
<tr class="separator:afa161ecc9fae4c6dbf5ef7063d777d1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad849b9fe0e266552696acb467ff745f7"><td class="memItemLeft" ><a id="ad849b9fe0e266552696acb467ff745f7"></a>
union {</td></tr>
<tr class="memitem:af900396d7b72ff2a7002e8befe8cf8f1"><td class="memItemLeft" >
&#160;&#160;&#160;float&#160;&#160;&#160;<b>f</b></td></tr>
<tr class="separator:af900396d7b72ff2a7002e8befe8cf8f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab38f6650bbe235d3d724250e9472baaf"><td class="memItemLeft" >
&#160;&#160;&#160;unsigned char&#160;&#160;&#160;<b>c</b> [4]</td></tr>
<tr class="separator:ab38f6650bbe235d3d724250e9472baaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad849b9fe0e266552696acb467ff745f7"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a></td></tr>
<tr class="memdesc:ad849b9fe0e266552696acb467ff745f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Float which contains the current voltage level on the Lipo battery. <br /></td></tr>
<tr class="separator:ad849b9fe0e266552696acb467ff745f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af76c5ac758d1858dffcde4e7aa84e889"><td class="memItemLeft" align="right" valign="top"><a id="af76c5ac758d1858dffcde4e7aa84e889"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#af76c5ac758d1858dffcde4e7aa84e889">batChannel</a></td></tr>
<tr class="memdesc:af76c5ac758d1858dffcde4e7aa84e889"><td class="mdescLeft">&#160;</td><td class="mdescRight">Char which keeps track of which ADC channel we are on. <br /></td></tr>
<tr class="separator:af76c5ac758d1858dffcde4e7aa84e889"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1fa4bbd357586cbfa309f1b8614c1ae"><td class="memItemLeft" align="right" valign="top"><a id="ab1fa4bbd357586cbfa309f1b8614c1ae"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a></td></tr>
<tr class="memdesc:ab1fa4bbd357586cbfa309f1b8614c1ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Holds the current operational mode of the engine. <br /></td></tr>
<tr class="separator:ab1fa4bbd357586cbfa309f1b8614c1ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a800e7967d4d08ade3357ea12c132dd46"><td class="memItemLeft" align="right" valign="top"><a id="a800e7967d4d08ade3357ea12c132dd46"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a800e7967d4d08ade3357ea12c132dd46">throttle_per</a></td></tr>
<tr class="memdesc:a800e7967d4d08ade3357ea12c132dd46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Char which keeps track of the throttle percentage 0-100. <br /></td></tr>
<tr class="separator:a800e7967d4d08ade3357ea12c132dd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a411b8ca204ac2d44a3755adcf4477c92"><td class="memItemLeft" ><a id="a411b8ca204ac2d44a3755adcf4477c92"></a>
union {</td></tr>
<tr class="memitem:af900396d7b72ff2a7002e8befe8cf8f1"><td class="memItemLeft" >
&#160;&#160;&#160;float&#160;&#160;&#160;<b>f</b></td></tr>
<tr class="separator:af900396d7b72ff2a7002e8befe8cf8f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab38f6650bbe235d3d724250e9472baaf"><td class="memItemLeft" >
&#160;&#160;&#160;unsigned char&#160;&#160;&#160;<b>c</b> [4]</td></tr>
<tr class="separator:ab38f6650bbe235d3d724250e9472baaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a411b8ca204ac2d44a3755adcf4477c92"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a></td></tr>
<tr class="memdesc:a411b8ca204ac2d44a3755adcf4477c92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Float holding the current mass flow rate. <br /></td></tr>
<tr class="separator:a411b8ca204ac2d44a3755adcf4477c92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc4ac50caf210854dacff228ba315687"><td class="memItemLeft" align="right" valign="top"><a id="afc4ac50caf210854dacff228ba315687"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#afc4ac50caf210854dacff228ba315687">Hall_effect</a></td></tr>
<tr class="memdesc:afc4ac50caf210854dacff228ba315687"><td class="mdescLeft">&#160;</td><td class="mdescRight">uint_16 holding the current measurement of the hall effect sensor <br /></td></tr>
<tr class="separator:afc4ac50caf210854dacff228ba315687"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c104e39ff60265f33e3325bf865ab5"><td class="memItemLeft" align="right" valign="top"><a id="a34c104e39ff60265f33e3325bf865ab5"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></td></tr>
<tr class="memdesc:a34c104e39ff60265f33e3325bf865ab5"><td class="mdescLeft">&#160;</td><td class="mdescRight">uint_16 holding the current measurement of the exhaust gas thermocouple <br /></td></tr>
<tr class="separator:a34c104e39ff60265f33e3325bf865ab5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17961c0bba1aa12ef80b5b9b78726530"><td class="memItemLeft" align="right" valign="top"><a id="a17961c0bba1aa12ef80b5b9b78726530"></a>
unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a17961c0bba1aa12ef80b5b9b78726530">glow_plug</a></td></tr>
<tr class="memdesc:a17961c0bba1aa12ef80b5b9b78726530"><td class="mdescLeft">&#160;</td><td class="mdescRight">unsigned char holding whether or not the glow plug is currently on <br /></td></tr>
<tr class="separator:a17961c0bba1aa12ef80b5b9b78726530"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9e36069f73b8a3642ae276fd3b672a1"><td class="memItemLeft" align="right" valign="top"><a id="af9e36069f73b8a3642ae276fd3b672a1"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a></td></tr>
<tr class="memdesc:af9e36069f73b8a3642ae276fd3b672a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This will keep track of how many pulses have been seen in the sampling window. <br /></td></tr>
<tr class="separator:af9e36069f73b8a3642ae276fd3b672a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d33ec29c2398728e80d752eeced889e"><td class="memItemLeft" align="right" valign="top"><a id="a4d33ec29c2398728e80d752eeced889e"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a></td></tr>
<tr class="memdesc:a4d33ec29c2398728e80d752eeced889e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Variable to convert the pulses into a voltage. <br /></td></tr>
<tr class="separator:a4d33ec29c2398728e80d752eeced889e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a543395e72464c9afc14f3766126d2d59"><td class="memItemLeft" align="right" valign="top"><a id="a543395e72464c9afc14f3766126d2d59"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a543395e72464c9afc14f3766126d2d59">commandMode</a></td></tr>
<tr class="memdesc:a543395e72464c9afc14f3766126d2d59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will keep track of the input format that the ECU will be expecting. <br /></td></tr>
<tr class="separator:a543395e72464c9afc14f3766126d2d59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a8bbdf0f587322d8d34a2d4b84ea8a6"><td class="memItemLeft" align="right" valign="top"><a id="a4a8bbdf0f587322d8d34a2d4b84ea8a6"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a4a8bbdf0f587322d8d34a2d4b84ea8a6">newCommand</a></td></tr>
<tr class="memdesc:a4a8bbdf0f587322d8d34a2d4b84ea8a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will keep track of whether or not it is possible for a new command stream to be coming in. <br /></td></tr>
<tr class="separator:a4a8bbdf0f587322d8d34a2d4b84ea8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8b367a3ec51bcbf0a598e54edda7610"><td class="memItemLeft" align="right" valign="top"><a id="ac8b367a3ec51bcbf0a598e54edda7610"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ac8b367a3ec51bcbf0a598e54edda7610">hasInterrupted</a></td></tr>
<tr class="memdesc:ac8b367a3ec51bcbf0a598e54edda7610"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will keep track of whether or not the message to the ESB has been interrupted by the PC. <br /></td></tr>
<tr class="separator:ac8b367a3ec51bcbf0a598e54edda7610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20d5783317799eb3e211c4cae2516cec"><td class="memItemLeft" align="right" valign="top"><a id="a20d5783317799eb3e211c4cae2516cec"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a20d5783317799eb3e211c4cae2516cec">connected_ESB</a></td></tr>
<tr class="memdesc:a20d5783317799eb3e211c4cae2516cec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will keep track of whether or not the ECU is connected to the windows GUI. <br /></td></tr>
<tr class="separator:a20d5783317799eb3e211c4cae2516cec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaa9e2d2909ceb75751c9dbfab30661c"><td class="memItemLeft" align="right" valign="top"><a id="aaaa9e2d2909ceb75751c9dbfab30661c"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#aaaa9e2d2909ceb75751c9dbfab30661c">connected_GUI</a></td></tr>
<tr class="memdesc:aaaa9e2d2909ceb75751c9dbfab30661c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Essentially boolean describing if the ECU is connected to the GUI or not. <br /></td></tr>
<tr class="separator:aaaa9e2d2909ceb75751c9dbfab30661c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a346573bf31cc5cb1e4a0d2d95029782a"><td class="memItemLeft" align="right" valign="top"><a id="a346573bf31cc5cb1e4a0d2d95029782a"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a> [11]</td></tr>
<tr class="memdesc:a346573bf31cc5cb1e4a0d2d95029782a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array of data which will be transmitted to the ESB. <br /></td></tr>
<tr class="separator:a346573bf31cc5cb1e4a0d2d95029782a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f9a0a6bf8fe3144553864f4081b3144"><td class="memItemLeft" align="right" valign="top"><a id="a4f9a0a6bf8fe3144553864f4081b3144"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a> [14]</td></tr>
<tr class="memdesc:a4f9a0a6bf8fe3144553864f4081b3144"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array containing the data received from the ESB. <br /></td></tr>
<tr class="separator:a4f9a0a6bf8fe3144553864f4081b3144"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0434de2efd3a26ea1211a9cec967577"><td class="memItemLeft" align="right" valign="top"><a id="ad0434de2efd3a26ea1211a9cec967577"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a></td></tr>
<tr class="memdesc:ad0434de2efd3a26ea1211a9cec967577"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ambient temperature of the ECU. <br /></td></tr>
<tr class="separator:ad0434de2efd3a26ea1211a9cec967577"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a359dd774222ff15507f3efb2d0e89bbe"><td class="memItemLeft" align="right" valign="top"><a id="a359dd774222ff15507f3efb2d0e89bbe"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a359dd774222ff15507f3efb2d0e89bbe">ESB_temp</a></td></tr>
<tr class="memdesc:a359dd774222ff15507f3efb2d0e89bbe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ambient temperature of the ESB. <br /></td></tr>
<tr class="separator:a359dd774222ff15507f3efb2d0e89bbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04e4c743fe091014b2a959319bc508ef"><td class="memItemLeft" align="right" valign="top"><a id="a04e4c743fe091014b2a959319bc508ef"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a04e4c743fe091014b2a959319bc508ef">connect_count</a></td></tr>
<tr class="memdesc:a04e4c743fe091014b2a959319bc508ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Counter for index into the connection string (The connection string is ACES) <br /></td></tr>
<tr class="separator:a04e4c743fe091014b2a959319bc508ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36d06dcce16c9c486a59c23947f2daf2"><td class="memItemLeft" align="right" valign="top"><a id="a36d06dcce16c9c486a59c23947f2daf2"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a36d06dcce16c9c486a59c23947f2daf2">newCommand_ESB</a></td></tr>
<tr class="memdesc:a36d06dcce16c9c486a59c23947f2daf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag which describes if the next received command is the beginning of a new command or the continuation of an old command. <br /></td></tr>
<tr class="separator:a36d06dcce16c9c486a59c23947f2daf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a229f3452d6df08f66a06e45b4ac03647"><td class="memItemLeft" align="right" valign="top"><a id="a229f3452d6df08f66a06e45b4ac03647"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#a229f3452d6df08f66a06e45b4ac03647">ESBreceiveCount</a></td></tr>
<tr class="memdesc:a229f3452d6df08f66a06e45b4ac03647"><td class="mdescLeft">&#160;</td><td class="mdescRight">Counter for the received byte in the current message. <br /></td></tr>
<tr class="separator:a229f3452d6df08f66a06e45b4ac03647"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8cc3e0359b222fe83e4f0351414d5a4"><td class="memItemLeft" align="right" valign="top"><a id="aa8cc3e0359b222fe83e4f0351414d5a4"></a>
int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a></td></tr>
<tr class="memdesc:aa8cc3e0359b222fe83e4f0351414d5a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag which is used to synchronize when messages are allowed to be sent to the GUI. <br /></td></tr>
<tr class="separator:aa8cc3e0359b222fe83e4f0351414d5a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Function prototypes, macros, constants, and global variables for ECU microcontroller. </p>
<p>Control register definitions and function prototypes for the ENC28J60 Ethernet controller.</p>
<dl class="section author"><dt>Author</dt><dd>Nick Moore </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 16, 2018 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000003">Bug:</a></b></dt><dd>No known bugs </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Nick Moore </dd></dl>
<dl class="section date"><dt>Date</dt><dd>June 21, 2018 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000005">Bug:</a></b></dt><dd>No known bugs </dd></dl>

<p class="definition">Definition in file <a class="el" href="_e_c_u__funcs_8h_source.html">ECU_funcs.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aba7fa75d6dd6ebcdc6225282a798fcd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba7fa75d6dd6ebcdc6225282a798fcd2">&#9670;&nbsp;</a></span>assign_bit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assign_bit </td>
          <td>(</td>
          <td class="paramtype">volatile uint8_t *&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>bit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the specified bit to the specified value or does nothing if it already set to that. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sfr</td><td>Pointer to Special Function Register the bit is located in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bit</td><td>Denotes the bit which would like to be changed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>The value, either 1 or 0, that the user would like the bit to be after the function call. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">104</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (val)      <span class="comment">// This is for if I want the value to be a 1</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        val = (val &lt;&lt; bit);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        *sfr |= val;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">else</span>             <span class="comment">// This is for if I want the value to be a 0</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        val = ~(1 &lt;&lt; bit);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        *sfr &amp;= val;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9dc66b4b2df662c440d4d05da08e6d6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9dc66b4b2df662c440d4d05da08e6d6a">&#9670;&nbsp;</a></span>batVoltage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void batVoltage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measures the voltage on the Lipo battery from the 3 different ADC channels. </p>
<p>This performs the following functions:</p>
<p>1) Measures the ADC voltage on the current ADC channel 2) Combines this result will the current float value of the voltage 3) Changes the ADC channel to the next one in the rotation 0-&gt;1-&gt;2-&gt;0</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00025">25</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00018">bit_is_set</a>, and <a class="el" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// first check to see if the conversion has completed</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#a3b034cb1d74b9addc7599bd6ea6bd0d9">bit_is_set</a>(ADCSRA,ADSC))</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    uint8_t low_bits = ADCL;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    uint8_t high_bits = ADCH;                        <span class="comment">// Do the shifting so that there is room made inside of the 16 bit register</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    uint16_t result = (high_bits &lt;&lt; 8) | low_bits;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Now I need to convert this 16 bit number into an actual temperature</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f = 3.0 * (float) result;            <span class="comment">// Convert to float value of the voltage</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f = <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f * (4.96 / 1024.0);      <span class="comment">// This will return Vin</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    ADCSRA |= (1 &lt;&lt; ADSC);                     <span class="comment">// Start the next conversion</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a3b034cb1d74b9addc7599bd6ea6bd0d9"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a3b034cb1d74b9addc7599bd6ea6bd0d9">bit_is_set</a></div><div class="ttdeci">#define bit_is_set(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is set. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00018">ECU_funcs.h:18</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ad849b9fe0e266552696acb467ff745f7"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a></div><div class="ttdeci">union @0 voltage</div><div class="ttdoc">Float which contains the current voltage level on the Lipo battery. </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adc85b180d655324bb96dcb29cff05af3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc85b180d655324bb96dcb29cff05af3">&#9670;&nbsp;</a></span>calculateParity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char calculateParity </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>message</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>start_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to calculate the parity byte for a corresponding sequence of 6 bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Entire message which a subset will be used in order to calculate the parity byte </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start_index</td><td>Starting index within message for which to calculate the parity byte </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>char </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00196">196</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00222">countOnes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// This will return the parity byte for a message made up of 6 sequential bytes, starting with start_index</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordtype">char</span> parity = 0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        </div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// first need to get the number of high bits in the first three bytes in the set</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keyword">set</span> = 0; <span class="keyword">set</span> &lt; 2; <span class="keyword">set</span>++){</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i = 0; i &lt; 3; i++){</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                count += <a class="code" href="_e_c_u__funcs_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a>(message[start_index + <span class="keyword">set</span>*3 + i]);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="comment">// now that I have the count for this set, I need to take the modulo</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            count = count % 16;   <span class="comment">// Modulo with 16 because I have 4 bits to play with</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            </div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="comment">// now add this into the parity byte</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            parity |= count &lt;&lt; (4 * <span class="keyword">set</span>);   <span class="comment">// this will make it so that bytes 0-2 will take up the LSB of the parity byte</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// now copy this byte into memory</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> parity;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8c_html_adb2fefa1023fbf227e5102e1ea3c9d4b"><div class="ttname"><a href="_e_c_u__funcs_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a></div><div class="ttdeci">unsigned char countOnes(unsigned char byte)</div><div class="ttdoc">Subroutine to count the number of high bits within a designated byte. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00222">ECU_funcs.c:222</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adb2fefa1023fbf227e5102e1ea3c9d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb2fefa1023fbf227e5102e1ea3c9d4b">&#9670;&nbsp;</a></span>countOnes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char countOnes </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine to count the number of high bits within a designated byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>The byte by which to calculate the number of high bits within </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00222">222</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">while</span> (byte)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        count += byte &amp; 1;    <span class="comment">// this was essentially lifted from geeksforgeeks.com</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        byte &gt;&gt;= 1;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> count;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aa3590f927d6f0e270aad13cd890ba3d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3590f927d6f0e270aad13cd890ba3d5">&#9670;&nbsp;</a></span>ESB_Connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESB_Connect </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Establishes the connection between the ECU and ESB. </p>
<p>This performs the following functions:</p>
<p>1) Prepares the ECU's password for transmission 2) Sends the password to the ESB 3) Awaits the correct return password from the ESB 4) repeats steps 2-4 until the proper return password is received</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00053">53</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00159">ESBtransmit</a>, and <a class="el" href="_communication_8c_source.html#l00028">sendToESB()</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[0] = <span class="charliteral">&#39;A&#39;</span>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[1] = <span class="charliteral">&#39;C&#39;</span>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[2] = <span class="charliteral">&#39;E&#39;</span>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[3] = <span class="charliteral">&#39;S&#39;</span>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a>(4);   </div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div><div class="ttc" id="_communication_8c_html_a9ad78c90a2e828201a614444385801c7"><div class="ttname"><a href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a></div><div class="ttdeci">void sendToESB(uint8_t len)</div><div class="ttdoc">Transmits data between the ECU and ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00028">Communication.c:28</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a346573bf31cc5cb1e4a0d2d95029782a"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a></div><div class="ttdeci">char ESBtransmit[11]</div><div class="ttdoc">Array of data which will be transmitted to the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00159">ECU_funcs.h:159</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada467eaa29152bd3a35afbf4d62e53fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada467eaa29152bd3a35afbf4d62e53fd">&#9670;&nbsp;</a></span>GUI_Connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GUI_Connect </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Establishes the connection between the ECU and Windows GUI. </p>
<p>This performs the following functions:</p>
<p>1) Prepares the ECU's password for transmission 2) Sends the password to the Windows GUI</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00073">73</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00156">connected_GUI</a>, and <a class="el" href="_e_c_u__funcs_8h_source.html#l00180">doTransmit</a>.</p>
<div class="fragment"><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">char</span> message[] = <span class="stringliteral">&quot;DALE&quot;</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 4; i++){                <span class="comment">// This will also send the terminator</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="comment">/* Wait for empty transmit buffer */</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">while</span> ( !( UCSR0A &amp; (1&lt;&lt;UDRE0)) );</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">/* Put data into buffer, sends the data */</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        UDR0 = message[i];</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#aaaa9e2d2909ceb75751c9dbfab30661c">connected_GUI</a> = 1;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a> = -1;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_aa8cc3e0359b222fe83e4f0351414d5a4"><div class="ttname"><a href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a></div><div class="ttdeci">int8_t doTransmit</div><div class="ttdoc">Flag which is used to synchronize when messages are allowed to be sent to the GUI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00180">ECU_funcs.h:180</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_aaaa9e2d2909ceb75751c9dbfab30661c"><div class="ttname"><a href="_e_c_u__funcs_8h.html#aaaa9e2d2909ceb75751c9dbfab30661c">connected_GUI</a></div><div class="ttdeci">uint8_t connected_GUI</div><div class="ttdoc">Essentially boolean describing if the ECU is connected to the GUI or not. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00156">ECU_funcs.h:156</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a23459ced73501cbafb717ca9cbb10ce7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23459ced73501cbafb717ca9cbb10ce7">&#9670;&nbsp;</a></span>Initial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Initial </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the microcontroller for its mainline execution. </p>
<p>This performs the following functions:</p>
<p>1) Initializes the PORT data directions. 0 for input and 1 for output</p>
<p>2) Initializes the asynchronous communication with the Windows GUI</p>
<p>3) Initializes the SPI communication with the ESB</p>
<p>4) Initializes the I2C communication with the on board temperature sensors</p>
<p>5) Initializes the ADC for the Lipo battery voltage measurements</p>
<p>6) Enable global interrupts</p>
<p>7) Enable a timer for the ECU command cycle and start the timer</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_initial__funcs_8c_source.html#l00049">49</a> of file <a class="el" href="_initial__funcs_8c_source.html">Initial_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    DDRD |= (1 &lt;&lt; XCK1);          <span class="comment">// Enable the SPI output pin for output.  This puts the ECU in master mode for SPI</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    UBRR0 = 12;     <span class="comment">// With a 16 MHz clock this will make a baud rate of 76800 (error of 0.16%)</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// The next things that need to be set are as follows (reference page 220 in datasheet)</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// 1) Enable receive interrupts</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// 2) Enable receiver</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// 3) Enable transmitter</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    UCSR0B = (1 &lt;&lt; RXCIE0) | (1 &lt;&lt; RXEN0) | (1 &lt;&lt; TXEN0);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// Now set the framing information</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// I want the following things</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// 1) Asynchronous USART</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// 2) No Parity</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// 3) 1 Stop bit</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// 4) 8 bit character size</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    UCSR0C = (1 &lt;&lt; UCSZ01) | (1 &lt;&lt; UCSZ00);   <span class="comment">// Now the USART should be ready to receive</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        </div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    UBRR1 = 12;     <span class="comment">// With a 16 MHz clock this will make a baud rate of 76800 (error of 0.16%)</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">//  This is the same process as with communication with the GUI</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    UCSR1B = (1 &lt;&lt; RXCIE1) | (1 &lt;&lt; RXEN1) | (1 &lt;&lt; TXEN1);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// Now set the framing information</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// I want the following things</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// 1) Asynchronous USART</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// 2) No Parity</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// 3) 1 Stop bit</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// 4) 8 bit character size</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    UCSR1C = (1 &lt;&lt; UCSZ11) | (1 &lt;&lt; UCSZ10);   <span class="comment">// Now the USART should be ready to receive</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a36d06dcce16c9c486a59c23947f2daf2">newCommand_ESB</a> = 1;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a229f3452d6df08f66a06e45b4ac03647">ESBreceiveCount</a> = 0;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a>(50);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">while</span> (!connected){     <span class="comment">// wait until connected with the ESB</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="_communication_8c.html#aa3590f927d6f0e270aad13cd890ba3d5">ESB_Connect</a>();</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <a class="code" href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a>(10);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// First set the bit rate and prescalar registers for a clock rate of 200 kHz (this is right in the middle of the sensor&#39;s range)</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    DDRD |= (1 &lt;&lt; PD0);     <span class="comment">// this will make the clock line an output</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    TWBR = 8;  <span class="comment">// Bit rate register</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TWSR, TWPS0, 0);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TWSR, TWPS1, 0);   <span class="comment">// this makes a prescalar of 1</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Probably don&#39;t need to make these assignments but I am just making it explicit</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// Second enable the interrupts for the Two Wire Interface</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    TWCR = (1&lt;&lt;TWEN);   <span class="comment">// this will clear the interrupt flag and enable the TWI lines.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// the temp sensor will be read every quarter second    </span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    </div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// The next things that need to be set are as follows</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// 1) The reference for the ADC needs to be set to the external AREF</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// 2) The channel for ADMUX needs to be channel 0</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// 3) The ADC needs to be enabled without interrupts</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// 4) Division factor for the ADC needs to be set to 128 to keep the input clock </span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">//    frequency between 50kHz and 200kHz</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    </div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    ADMUX = (1 &lt;&lt; REFS0);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    ADCSRA = (1 &lt;&lt; ADEN) | (1 &lt;&lt; ADPS0) | (1 &lt;&lt; ADPS1) | (1 &lt;&lt; ADPS2);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#af76c5ac758d1858dffcde4e7aa84e889">batChannel</a> = 0;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    sei();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;     </div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// The next things that need to be set are as follows</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// 1) Timer 1 needs a prescalar of 64 and timer register of 3036    for time of 0.25 sec, for regulating communication with the ESB</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// 2) Timer 3 needs a prescalar of 64 and timer register if 3036</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// 3) Timer 4 and 5 needs to have interrupts enabled and create a 1 second timer</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    TCNT1 = 3036;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    TCNT3 = FlowTime;             <span class="comment">// The flow meter timer does not need interrupts since it will be polled</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    </div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// The TIFR1 register and TOV1 flag are the overflow flag for timer1</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    TCCR1B = (1 &lt;&lt; CS11) | (1 &lt;&lt; CS10);    <span class="comment">// start timer 1 with prescalar of 64</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    TCNT4 = 34286;                         <span class="comment">// coupled with a prescalar of 256, this will make a 0.5 second timer</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    TCNT5 = 40536;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    TIMSK4 = (1 &lt;&lt; TOIE4);     <span class="comment">// enable overflow interrupts for the GUI communication timer</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    TIMSK5 = (1 &lt;&lt; TOIE5);     <span class="comment">// enable overflow interrupts for the ESB communication timer</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    TCNT5 = ESB_timer_val;     <span class="comment">// loads Timer 5 with a value that will make a 1 second timer</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    </div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// Begin the first conversion for the ADC</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    ADCSRA |= (1 &lt;&lt; ADSC);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    </div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a>.f = 0.0;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;     </div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// Now configure the external interrupts for the Flow meters</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    EICRA = (1 &lt;&lt; ISC20) | (1 &lt;&lt; ISC21);     <span class="comment">// This will enable rising edge interrupts on INT2, see page 110 in datasheet</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;DDRD, INT2, 0);              <span class="comment">// Configure the PD2 pin as an input so that it can receive the signals</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;     </div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;     </div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// Now configure the global variables for the flow meter</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">float</span> pulse_flow = (<a class="code" href="_e_c_u__funcs_8h.html#a959f7b5d831006ba86ebf2754975fdfc">density</a>) * <a class="code" href="_e_c_u__funcs_8h.html#a062607eaaffe8c3f8193991755e024f9">K_factor</a> * <a class="code" href="_e_c_u__funcs_8h.html#a0f29307316da99a662028868a7f7636d">max_time</a> / 1000;   <span class="comment">// number of pulses expected per g/sec</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a> = <a class="code" href="_e_c_u__funcs_8h.html#a8f24004cae5e9f858db493e25febf8c8">pump_m</a> / pulse_flow;               <span class="comment">// number of volts per pulse</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> = 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a4a8bbdf0f587322d8d34a2d4b84ea8a6">newCommand</a> = 1;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// Initialize all of the data values to zero</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a>.f = 0;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#afc4ac50caf210854dacff228ba315687">Hall_effect</a> = 0;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a> = 0;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a17961c0bba1aa12ef80b5b9b78726530">glow_plug</a> = 0;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f = 0;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a> = 0;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    </div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    </div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a17961c0bba1aa12ef80b5b9b78726530"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a17961c0bba1aa12ef80b5b9b78726530">glow_plug</a></div><div class="ttdeci">unsigned char glow_plug</div><div class="ttdoc">unsigned char holding whether or not the glow plug is currently on </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00135">ECU_funcs.h:135</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a4d33ec29c2398728e80d752eeced889e"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a4d33ec29c2398728e80d752eeced889e">V_per_pulse</a></div><div class="ttdeci">float V_per_pulse</div><div class="ttdoc">Variable to convert the pulses into a voltage. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00141">ECU_funcs.h:141</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a959f7b5d831006ba86ebf2754975fdfc"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a959f7b5d831006ba86ebf2754975fdfc">density</a></div><div class="ttdeci">#define density</div><div class="ttdoc">Density of the kerosene in g/ml. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00036">ECU_funcs.h:36</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_afc4ac50caf210854dacff228ba315687"><div class="ttname"><a href="_e_c_u__funcs_8h.html#afc4ac50caf210854dacff228ba315687">Hall_effect</a></div><div class="ttdeci">uint16_t Hall_effect</div><div class="ttdoc">uint_16 holding the current measurement of the hall effect sensor </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00129">ECU_funcs.h:129</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ab1fa4bbd357586cbfa309f1b8614c1ae"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a></div><div class="ttdeci">char opMode</div><div class="ttdoc">Holds the current operational mode of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00117">ECU_funcs.h:117</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a062607eaaffe8c3f8193991755e024f9"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a062607eaaffe8c3f8193991755e024f9">K_factor</a></div><div class="ttdeci">#define K_factor</div><div class="ttdoc">Assumed K factor for the flow meter in pulses per liter. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00033">ECU_funcs.h:33</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a411b8ca204ac2d44a3755adcf4477c92"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a></div><div class="ttdeci">union @1 massFlow</div><div class="ttdoc">Float holding the current mass flow rate. </div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">uint_16 holding the current measurement of the exhaust gas thermocouple </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00132">ECU_funcs.h:132</a></div></div>
<div class="ttc" id="_communication_8c_html_aa3590f927d6f0e270aad13cd890ba3d5"><div class="ttname"><a href="_communication_8c.html#aa3590f927d6f0e270aad13cd890ba3d5">ESB_Connect</a></div><div class="ttdeci">void ESB_Connect(void)</div><div class="ttdoc">Establishes the connection between the ECU and ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00053">Communication.c:53</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_af76c5ac758d1858dffcde4e7aa84e889"><div class="ttname"><a href="_e_c_u__funcs_8h.html#af76c5ac758d1858dffcde4e7aa84e889">batChannel</a></div><div class="ttdeci">char batChannel</div><div class="ttdoc">Char which keeps track of which ADC channel we are on. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00114">ECU_funcs.h:114</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a36d06dcce16c9c486a59c23947f2daf2"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a36d06dcce16c9c486a59c23947f2daf2">newCommand_ESB</a></div><div class="ttdeci">uint8_t newCommand_ESB</div><div class="ttdoc">Flag which describes if the next received command is the beginning of a new command or the continuati...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00174">ECU_funcs.h:174</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_abfac85317b9c1522c7b5196d94e471bd"><div class="ttname"><a href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a></div><div class="ttdeci">void waitMS(uint16_t msec)</div><div class="ttdoc">Subroutine which will wait for a given number of milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00238">ECU_funcs.c:238</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a4a8bbdf0f587322d8d34a2d4b84ea8a6"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a4a8bbdf0f587322d8d34a2d4b84ea8a6">newCommand</a></div><div class="ttdeci">uint8_t newCommand</div><div class="ttdoc">Will keep track of whether or not it is possible for a new command stream to be coming in...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00147">ECU_funcs.h:147</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_aa8cc3e0359b222fe83e4f0351414d5a4"><div class="ttname"><a href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a></div><div class="ttdeci">int8_t doTransmit</div><div class="ttdoc">Flag which is used to synchronize when messages are allowed to be sent to the GUI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00180">ECU_funcs.h:180</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a8f24004cae5e9f858db493e25febf8c8"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a8f24004cae5e9f858db493e25febf8c8">pump_m</a></div><div class="ttdeci">#define pump_m</div><div class="ttdoc">Slope for the linear relationship between voltage and mass flow (put in mf, get volts) ...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00042">ECU_funcs.h:42</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a229f3452d6df08f66a06e45b4ac03647"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a229f3452d6df08f66a06e45b4ac03647">ESBreceiveCount</a></div><div class="ttdeci">uint8_t ESBreceiveCount</div><div class="ttdoc">Counter for the received byte in the current message. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00177">ECU_funcs.h:177</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ad849b9fe0e266552696acb467ff745f7"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a></div><div class="ttdeci">union @0 voltage</div><div class="ttdoc">Float which contains the current voltage level on the Lipo battery. </div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a0f29307316da99a662028868a7f7636d"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a0f29307316da99a662028868a7f7636d">max_time</a></div><div class="ttdeci">#define max_time</div><div class="ttdoc">Maximum amount of time for an 8 bit timer with a prescalar of 1024. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00039">ECU_funcs.h:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a61322b047675f61caefcfaca81cfa48b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61322b047675f61caefcfaca81cfa48b">&#9670;&nbsp;</a></span>measureFlow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void measureFlow </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measures the fuel flow passing through the Flow meter. </p>
<p>This performs the following functions:</p>
<p>1) If the flow meter measurement has not started, it enables the appropriate interrupts and returns 2) If the flow meter measurement is in progress, it simply returns 3) If the flow meter measurement has concluded, it calculates the recorded pulses</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00054">54</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">assign_bit()</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00022">bit_is_clear</a>, and <a class="el" href="_e_c_u__funcs_8h_source.html#l00138">pulse_count</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a> = 0;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    EIMSK |= (1 &lt;&lt; INT2);    <span class="comment">// enable the external interrupts</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// Now start Timer3 to run for 0.25 sec</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    TCCR3B |= (1 &lt;&lt; CS31) | (1 &lt;&lt; CS30);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(TIFR3, TOV3));       <span class="comment">// hog execution until the overflow flag has been set</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    TIFR3 |= (1 &lt;&lt; TOV3);                    <span class="comment">// clear the interrupt flag</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// now disable the external interrupt</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;EIMSK, INT2, 0);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    </div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Now turn off Timer 3</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR3B, CS31, 0);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR3B, CS30, 0);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// Now reset the value inside of the TIMER3 register</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    TCNT3 = FlowTime;    <span class="comment">// This will allow the timer to run for 0.25 sec once the prescalars are restored</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// Now need to convert the pulses detected into an actual flow rate</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">//massFlow.f = V_per_pulse * (float) pulse_count;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">//massFlow.f = (massFlow.f - pump_b) / pump_m;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// now set the doTransmit flag</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a> &lt; 1){</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a>++;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00022">ECU_funcs.h:22</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_af9e36069f73b8a3642ae276fd3b672a1"><div class="ttname"><a href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a></div><div class="ttdeci">uint8_t pulse_count</div><div class="ttdoc">This will keep track of how many pulses have been seen in the sampling window. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00138">ECU_funcs.h:138</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_aa8cc3e0359b222fe83e4f0351414d5a4"><div class="ttname"><a href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a></div><div class="ttdeci">int8_t doTransmit</div><div class="ttdoc">Flag which is used to synchronize when messages are allowed to be sent to the GUI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00180">ECU_funcs.h:180</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a013b823a1365a9c8f46218f490f71b62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a013b823a1365a9c8f46218f490f71b62">&#9670;&nbsp;</a></span>pre_Initial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pre_Initial </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the waiting cycle until the HCU signals to the ECU to being operating. </p>
<p>This performs the following functions:</p>
<p>1) Waits until the connection pin between the HCU and ECU is driven high</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_initial__funcs_8c_source.html#l00022">22</a> of file <a class="el" href="_initial__funcs_8c_source.html">Initial_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    DDRC |= (0 &lt;&lt; HCU_link);      <span class="comment">// set this pin for input</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(PINC, HCU_link));    <span class="comment">// just wait until the HCU tells the ECU to wake up</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00022">ECU_funcs.h:22</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17727302d45ecff548af8f81d06f3a7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17727302d45ecff548af8f81d06f3a7e">&#9670;&nbsp;</a></span>readTempSensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readTempSensor </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accesses memory within the MAX6675 and converts the data into a usable temperature. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00152">152</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    i2c_Start(SLA_W);   <span class="comment">// this will write the temp address to the register on the sensor</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    i2c_write(0x05);    <span class="comment">// this references the temperatures location in memory</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// now restart I2C so that it will be configured for reading the temperature</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    i2c_Start(SLA_R);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// now read the upper and lower bytes</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> upper = i2c_read(1);   <span class="comment">// this will send the acknowledged bit</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> lower = i2c_read(0);   <span class="comment">// this will send the not acknowledged bit</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    i2c_Stop();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    </div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// now process the data into a usable temperature</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">//First Check flag bits</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x80) == 0x80){ <span class="comment">//TA &gt;= TCRIT</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x40) == 0x40){ <span class="comment">//TA &gt; TUPPER</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x20) == 0x20){ <span class="comment">//TA &lt; TLOWER</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    </div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    upper = upper &amp; 0x1F; <span class="comment">//Clear flag bits</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    uint8_t decimal = (lower &amp; dec_MSK) &gt;&gt; 2;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x10) == 0x10){ <span class="comment">//TA &lt; 0C</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        upper = upper &amp; 0x0F; <span class="comment">//Clear SIGN</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> = (float)(256 - ((upper &lt;&lt; 4) + (lower &gt;&gt; 4)));</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> -= (0.25 * decimal);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">else</span> { <span class="comment">//TA &gt;= 0C</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> = (float)((upper &lt;&lt; 4) + (lower &gt;&gt; 4));     <span class="comment">//Temperature = Ambient Temperature (C)</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> += (0.25 * decimal);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad0434de2efd3a26ea1211a9cec967577"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a></div><div class="ttdeci">float ECU_temp</div><div class="ttdoc">Ambient temperature of the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00165">ECU_funcs.h:165</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a285a2f8773a070acdcea234b60cf38ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a285a2f8773a070acdcea234b60cf38ca">&#9670;&nbsp;</a></span>repeatCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void repeatCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Requests the Windows GUI to repeat the last sent command. </p>
<p>This performs the following functions:</p>
<p>1) Sends the char to the GUI which signals a command repetition is required</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00349">349</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;{</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">/* Wait for empty transmit buffer */</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">while</span> ( !( UCSR0A &amp; (1&lt;&lt;UDRE0)) );</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    </div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">/* Put data into buffer, sends the data */</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    UDR0 = <span class="charliteral">&#39;V&#39;</span>; </div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// Will have to see in unit testing how long this takes to get the response from the GUI</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9ad78c90a2e828201a614444385801c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ad78c90a2e828201a614444385801c7">&#9670;&nbsp;</a></span>sendToESB()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendToESB </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transmits data between the ECU and ESB. </p>
<p>This performs the following functions:</p>
<p>1) Pulls the SS line for the ESB low, this will cause the ESB to listen to the com line 2) Fills the specified data into the transmit buffer 3) Waits for the data to be received from the ESB 4) Pulls the SS line high to end communication with ESB for that byte</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">char</td><td>The byte that is going to be sent to the ESB </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>char The received byte from the ESB </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00028">28</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00159">ESBtransmit</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// this will send the number of character in ESBmessage up to len</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    cli();</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">for</span>(uint8_t i = 0; i &lt; len; i++)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordflow">while</span> ( !( UCSR1A &amp; (1&lt;&lt;UDRE1)) );</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="comment">/* Put data into buffer, sends the data */</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        UDR1 = <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[i];</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    sei();</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a346573bf31cc5cb1e4a0d2d95029782a"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a></div><div class="ttdeci">char ESBtransmit[11]</div><div class="ttdoc">Array of data which will be transmitted to the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00159">ECU_funcs.h:159</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aebc6f692b7c3787a859445b96ab3ec5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebc6f692b7c3787a859445b96ab3ec5f">&#9670;&nbsp;</a></span>sendToLaptop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendToLaptop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transmits periodic data between the ECU and Windows GUI. </p>
<p>This performs the following functions:</p>
<p>1) Prepares the message to send to the Windows GUI 2) Loops through this message, sending it one byte at a time</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_communication_8c_source.html#l00096">96</a> of file <a class="el" href="_communication_8c_source.html">Communication.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00196">calculateParity()</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00153">connected_ESB</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00165">ECU_temp</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00132">EGT</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00168">ESB_temp</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00135">glow_plug</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00129">Hall_effect</a>, <a class="el" href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00117">opMode</a>, and <a class="el" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.</p>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">//loadESBData();</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    dummyData();    <span class="comment">// remove this later</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// This function will be responsible for packaging and sending the desired data to the Windows GUI</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordtype">char</span> message[28];              <span class="comment">// this is the base length of the message with room for the parity bytes</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// now fill the message</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="_e_c_u__funcs_8h.html#a20d5783317799eb3e211c4cae2516cec">connected_ESB</a>){</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        message[0] = <span class="charliteral">&#39;b&#39;</span>;          <span class="comment">// This means that the ESB is not connected or it has lost connection</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 0){</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        message[0] = <span class="charliteral">&#39;S&#39;</span>;          <span class="comment">// This means that an engine shutdown is being carried out</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 1){</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        message[0] = <span class="charliteral">&#39;r&#39;</span>;          <span class="comment">// This means that an engine startup is in progress</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 2){</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        message[0] = <span class="charliteral">&#39;t&#39;</span>;          <span class="comment">// This means that a throttle adjustment has been requested and is being carried out</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 4){</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        message[0] = <span class="charliteral">&#39;C&#39;</span>;          <span class="comment">// This means that the engine is in the cooling mode</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 5){</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        message[0] = <span class="charliteral">&#39;n&#39;</span>;          <span class="comment">// The engine is not doing anything</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 6){</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        message[0] = <span class="charliteral">&#39;g&#39;</span>;          <span class="comment">// Special shutdown, the EGT is not working properly and there cannot be a normal cooling mode</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 7){</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        message[0] = <span class="charliteral">&#39;N&#39;</span>;          <span class="comment">// This means that the engine has reached the desired throttle, within the error tolerance</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 9){         <span class="comment">// This means that fuel is not flowing when it should be flowing</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        message[0] = <span class="charliteral">&#39;P&#39;</span>;   </div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 10){</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        message[0] = <span class="charliteral">&#39;I&#39;</span>;          <span class="comment">// This means that the engine has reached idle</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 11){</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        message[0] = <span class="charliteral">&#39;c&#39;</span>;          <span class="comment">// This means that messages from the ECU have failed the parity check</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 12){</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        message[0] = <span class="charliteral">&#39;R&#39;</span>;          <span class="comment">// This means that RPM limit has been reached and the engine is shutting down</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 13){</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        message[0] = <span class="charliteral">&#39;T&#39;</span>;          <span class="comment">// This means the Temperature limit has been reached and the engine is shutting down</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 14){</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        message[0] = <span class="charliteral">&#39;s&#39;</span>;          <span class="comment">// This means that messages from the ESB have failed the parity check</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        </div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    memcpy(message+1,&amp;<a class="code" href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));          <span class="comment">// This should fill 1-&gt;4 with the float value</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    memcpy(message+5,&amp;<a class="code" href="_e_c_u__funcs_8h.html#afc4ac50caf210854dacff228ba315687">Hall_effect</a>,<span class="keyword">sizeof</span>(uint16_t));    <span class="comment">// This should fill 5-&gt;6 with the Hall effect sensor value</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    memcpy(message+7,&amp;<a class="code" href="_e_c_u__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));            <span class="comment">// This should fill 7-&gt;8 with the EGT value </span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    memcpy(message+11,&amp;<a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));      <span class="comment">// this should fill 9-&gt;12 with the value of the battery voltage</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    memcpy(message+15,&amp;<a class="code" href="_e_c_u__funcs_8h.html#a17961c0bba1aa12ef80b5b9b78726530">glow_plug</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));         <span class="comment">// This should fill 13 with the glow plug on/off</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    memcpy(message+16,&amp;<a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));         <span class="comment">// This should fill 14-&gt;17 with the temperature of the ECU</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    memcpy(message+20,&amp;<a class="code" href="_e_c_u__funcs_8h.html#a359dd774222ff15507f3efb2d0e89bbe">ESB_temp</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));         <span class="comment">// This should fill 18-&gt;21 with the ambient temperature of the ESB</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    </div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// now that the message is made, I need to calculate and populate the parity bytes</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    message[24] = <a class="code" href="_e_c_u__funcs_8c.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a>(message, 0);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    message[25] = <a class="code" href="_e_c_u__funcs_8c.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a>(message, 6);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    message[26] = <a class="code" href="_e_c_u__funcs_8c.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a>(message, 12);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    message[27] = <a class="code" href="_e_c_u__funcs_8c.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a>(message, 18);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// At this point it is advantageous to turn off global interrupts so that this process is not interrupted</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    cli();</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 28; i++){</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">/* Wait for empty transmit buffer */</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">while</span> ( !( UCSR0A &amp; (1&lt;&lt;UDRE0)) );</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment">/* Put data into buffer, sends the data */</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        UDR0 = message[i];</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    sei();   <span class="comment">// Now need to turn global interrupts back on</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// Now start the timer</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    </div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    TCCR4B = (1 &lt;&lt; CS42);      <span class="comment">// start timer 4 with prescalar of 256</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a17961c0bba1aa12ef80b5b9b78726530"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a17961c0bba1aa12ef80b5b9b78726530">glow_plug</a></div><div class="ttdeci">unsigned char glow_plug</div><div class="ttdoc">unsigned char holding whether or not the glow plug is currently on </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00135">ECU_funcs.h:135</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a20d5783317799eb3e211c4cae2516cec"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a20d5783317799eb3e211c4cae2516cec">connected_ESB</a></div><div class="ttdeci">uint8_t connected_ESB</div><div class="ttdoc">Will keep track of whether or not the ECU is connected to the windows GUI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00153">ECU_funcs.h:153</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a359dd774222ff15507f3efb2d0e89bbe"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a359dd774222ff15507f3efb2d0e89bbe">ESB_temp</a></div><div class="ttdeci">float ESB_temp</div><div class="ttdoc">Ambient temperature of the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00168">ECU_funcs.h:168</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_adc85b180d655324bb96dcb29cff05af3"><div class="ttname"><a href="_e_c_u__funcs_8c.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a></div><div class="ttdeci">char calculateParity(char message[], uint8_t start_index)</div><div class="ttdoc">Function to calculate the parity byte for a corresponding sequence of 6 bytes. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00196">ECU_funcs.c:196</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_afc4ac50caf210854dacff228ba315687"><div class="ttname"><a href="_e_c_u__funcs_8h.html#afc4ac50caf210854dacff228ba315687">Hall_effect</a></div><div class="ttdeci">uint16_t Hall_effect</div><div class="ttdoc">uint_16 holding the current measurement of the hall effect sensor </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00129">ECU_funcs.h:129</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ab1fa4bbd357586cbfa309f1b8614c1ae"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a></div><div class="ttdeci">char opMode</div><div class="ttdoc">Holds the current operational mode of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00117">ECU_funcs.h:117</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a411b8ca204ac2d44a3755adcf4477c92"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a411b8ca204ac2d44a3755adcf4477c92">massFlow</a></div><div class="ttdeci">union @1 massFlow</div><div class="ttdoc">Float holding the current mass flow rate. </div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a34c104e39ff60265f33e3325bf865ab5"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a34c104e39ff60265f33e3325bf865ab5">EGT</a></div><div class="ttdeci">float EGT</div><div class="ttdoc">uint_16 holding the current measurement of the exhaust gas thermocouple </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00132">ECU_funcs.h:132</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ad0434de2efd3a26ea1211a9cec967577"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a></div><div class="ttdeci">float ECU_temp</div><div class="ttdoc">Ambient temperature of the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00165">ECU_funcs.h:165</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ad849b9fe0e266552696acb467ff745f7"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a></div><div class="ttdeci">union @0 voltage</div><div class="ttdoc">Float which contains the current voltage level on the Lipo battery. </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1c9d5e29ad8899afe0c34571ddee18f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c9d5e29ad8899afe0c34571ddee18f9">&#9670;&nbsp;</a></span>shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void shutdown </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Commands the ESB to shutdown and awaits the confirmation code. </p>
<p>This performs the following functions:</p>
<p>1) Transmits the char to the ESB for the shutdown sequence 2) Waits for the appropriate return message 3) If the function was interrupted part way through by an interrupt, it is restarted</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00024">24</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00162">ESBreceive</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00159">ESBtransmit</a>, <a class="el" href="_communication_8c_source.html#l00028">sendToESB()</a>, and <a class="el" href="_e_c_u__funcs_8c_source.html#l00238">waitMS()</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[0] = <span class="charliteral">&#39;S&#39;</span>;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a>[0] != <span class="charliteral">&#39;K&#39;</span>){                    <span class="comment">// Loop until the ESB says K</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <a class="code" href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a>(1);</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <a class="code" href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a>(5);</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    }</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a>[0] = 0;                              <span class="comment">// clear out the first char so that it actually transmits</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a4f9a0a6bf8fe3144553864f4081b3144"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a></div><div class="ttdeci">char ESBreceive[14]</div><div class="ttdoc">Array containing the data received from the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00162">ECU_funcs.h:162</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_abfac85317b9c1522c7b5196d94e471bd"><div class="ttname"><a href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a></div><div class="ttdeci">void waitMS(uint16_t msec)</div><div class="ttdoc">Subroutine which will wait for a given number of milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00238">ECU_funcs.c:238</a></div></div>
<div class="ttc" id="_communication_8c_html_a9ad78c90a2e828201a614444385801c7"><div class="ttname"><a href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a></div><div class="ttdeci">void sendToESB(uint8_t len)</div><div class="ttdoc">Transmits data between the ECU and ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00028">Communication.c:28</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a346573bf31cc5cb1e4a0d2d95029782a"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a></div><div class="ttdeci">char ESBtransmit[11]</div><div class="ttdoc">Array of data which will be transmitted to the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00159">ECU_funcs.h:159</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab0c801cf89f8b3058ff2460c666154c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0c801cf89f8b3058ff2460c666154c3">&#9670;&nbsp;</a></span>startup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void startup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Commands the ESB to startup and awaits the confirmation code. </p>
<p>This performs the following functions:</p>
<p>1) Transmits the char to the ESB for the startup sequence 2) Waits for the appropriate return message 3) If the function was interrupted part way through by an interrupt, it is restarted</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00045">45</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00162">ESBreceive</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00159">ESBtransmit</a>, <a class="el" href="_communication_8c_source.html#l00028">sendToESB()</a>, and <a class="el" href="_e_c_u__funcs_8c_source.html#l00238">waitMS()</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[0] = <span class="charliteral">&#39;r&#39;</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a>[0] != <span class="charliteral">&#39;K&#39;</span>){</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a>(1);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a>(5);   </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a>[0] = 0;              <span class="comment">// Change this character so I actually have to receive it in the future </span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a4f9a0a6bf8fe3144553864f4081b3144"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a></div><div class="ttdeci">char ESBreceive[14]</div><div class="ttdoc">Array containing the data received from the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00162">ECU_funcs.h:162</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_abfac85317b9c1522c7b5196d94e471bd"><div class="ttname"><a href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a></div><div class="ttdeci">void waitMS(uint16_t msec)</div><div class="ttdoc">Subroutine which will wait for a given number of milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00238">ECU_funcs.c:238</a></div></div>
<div class="ttc" id="_communication_8c_html_a9ad78c90a2e828201a614444385801c7"><div class="ttname"><a href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a></div><div class="ttdeci">void sendToESB(uint8_t len)</div><div class="ttdoc">Transmits data between the ECU and ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00028">Communication.c:28</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a346573bf31cc5cb1e4a0d2d95029782a"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a></div><div class="ttdeci">char ESBtransmit[11]</div><div class="ttdoc">Array of data which will be transmitted to the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00159">ECU_funcs.h:159</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a54163ad9d4f9e7fa08b4aae836a1b316"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54163ad9d4f9e7fa08b4aae836a1b316">&#9670;&nbsp;</a></span>throttle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void throttle </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Commands the ESB to adjust the throttle and awaits the confirmation code. </p>
<p>This performs the following functions:</p>
<p>1) Transmits the char to the ESB to change the throttle 2) Sends the new value the throttle should be changed to 3) Awaits for the appropriate return message 4) If the function was interrupted part way through by an interrupt, it is restarted</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_engine__funcs_8c_source.html#l00068">68</a> of file <a class="el" href="_engine__funcs_8c_source.html">Engine_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00162">ESBreceive</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00159">ESBtransmit</a>, <a class="el" href="_communication_8c_source.html#l00028">sendToESB()</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00120">throttle_per</a>, and <a class="el" href="_e_c_u__funcs_8c_source.html#l00238">waitMS()</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[0] = <span class="charliteral">&#39;t&#39;</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a>[1] = <a class="code" href="_e_c_u__funcs_8h.html#a800e7967d4d08ade3357ea12c132dd46">throttle_per</a>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a>[0] != <span class="charliteral">&#39;K&#39;</span>){</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a>(2);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a>(5);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a>[0] = 0;                   <span class="comment">// clear out the first char so that it actually transmits</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a800e7967d4d08ade3357ea12c132dd46"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a800e7967d4d08ade3357ea12c132dd46">throttle_per</a></div><div class="ttdeci">uint8_t throttle_per</div><div class="ttdoc">Char which keeps track of the throttle percentage 0-100. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00120">ECU_funcs.h:120</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a4f9a0a6bf8fe3144553864f4081b3144"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a4f9a0a6bf8fe3144553864f4081b3144">ESBreceive</a></div><div class="ttdeci">char ESBreceive[14]</div><div class="ttdoc">Array containing the data received from the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00162">ECU_funcs.h:162</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_abfac85317b9c1522c7b5196d94e471bd"><div class="ttname"><a href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a></div><div class="ttdeci">void waitMS(uint16_t msec)</div><div class="ttdoc">Subroutine which will wait for a given number of milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00238">ECU_funcs.c:238</a></div></div>
<div class="ttc" id="_communication_8c_html_a9ad78c90a2e828201a614444385801c7"><div class="ttname"><a href="_communication_8c.html#a9ad78c90a2e828201a614444385801c7">sendToESB</a></div><div class="ttdeci">void sendToESB(uint8_t len)</div><div class="ttdoc">Transmits data between the ECU and ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_communication_8c_source.html#l00028">Communication.c:28</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a346573bf31cc5cb1e4a0d2d95029782a"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a346573bf31cc5cb1e4a0d2d95029782a">ESBtransmit</a></div><div class="ttdeci">char ESBtransmit[11]</div><div class="ttdoc">Array of data which will be transmitted to the ESB. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00159">ECU_funcs.h:159</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abfac85317b9c1522c7b5196d94e471bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfac85317b9c1522c7b5196d94e471bd">&#9670;&nbsp;</a></span>waitMS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void waitMS </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>msec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine which will wait for a given number of milliseconds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msec</td><td>Number of milliseconds to wait </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00238">238</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">assign_bit()</a>, and <a class="el" href="_e_c_u__funcs_8h_source.html#l00022">bit_is_clear</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// This function utilizes timer 0 and a sequence of delay loops to delay for the desired time</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    TCNT0 = 5;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// begin the timer</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    TCCR0B |= (1 &lt;&lt; CS01) | (1 &lt;&lt; CS00);       <span class="comment">// this will start the timer with a prescalar of 64</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; msec; i++){</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">while</span>(<a class="code" href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(TIFR0, TOV0));</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        TIFR0 |= (1 &lt;&lt; TOV0);                  <span class="comment">// Clear the overflow flag by writing a 1 to it</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0B, CS01, 0);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0B, CS00, 0);              <span class="comment">// Turn off the timer</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00022">ECU_funcs.h:22</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
