<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACES ECU: C:/Users/nickm/Documents/GitHub/ACES_ECU/ACES_ECU/ECU_funcs.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACES ECU
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Software Implementation of Team ACES ECU</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">C:/Users/nickm/Documents/GitHub/ACES_ECU/ACES_ECU/ECU_funcs.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation for functions for local processes on the ECU.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;avr/io.h&gt;</code><br />
<code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_e_c_u__funcs_8h_source.html">ECU_funcs.h</a>&quot;</code><br />
</div>
<p><a href="_e_c_u__funcs_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9dc66b4b2df662c440d4d05da08e6d6a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#a9dc66b4b2df662c440d4d05da08e6d6a">batVoltage</a> (void)</td></tr>
<tr class="memdesc:a9dc66b4b2df662c440d4d05da08e6d6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measures the voltage on the Lipo battery from the 3 different ADC channels.  <a href="#a9dc66b4b2df662c440d4d05da08e6d6a">More...</a><br /></td></tr>
<tr class="separator:a9dc66b4b2df662c440d4d05da08e6d6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61322b047675f61caefcfaca81cfa48b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#a61322b047675f61caefcfaca81cfa48b">measureFlow</a> (void)</td></tr>
<tr class="memdesc:a61322b047675f61caefcfaca81cfa48b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measures the fuel flow passing through the Flow meter.  <a href="#a61322b047675f61caefcfaca81cfa48b">More...</a><br /></td></tr>
<tr class="separator:a61322b047675f61caefcfaca81cfa48b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30a0ad88a89a84c0161cf09eace108e8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#a30a0ad88a89a84c0161cf09eace108e8">ISR</a> (INT2_vect)</td></tr>
<tr class="memdesc:a30a0ad88a89a84c0161cf09eace108e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt Service Routine which reads in the pulse train and increments a count.  <a href="#a30a0ad88a89a84c0161cf09eace108e8">More...</a><br /></td></tr>
<tr class="separator:a30a0ad88a89a84c0161cf09eace108e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a> (volatile uint8_t *sfr, uint8_t bit, uint8_t val)</td></tr>
<tr class="memdesc:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the specified bit to the specified value or does nothing if it already set to that.  <a href="#aba7fa75d6dd6ebcdc6225282a798fcd2">More...</a><br /></td></tr>
<tr class="separator:aba7fa75d6dd6ebcdc6225282a798fcd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33c40fdd48fd7bb540f034e5c489a38b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#a33c40fdd48fd7bb540f034e5c489a38b">ISR</a> (TIMER4_OVF_vect)</td></tr>
<tr class="memdesc:a33c40fdd48fd7bb540f034e5c489a38b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt Service Routine which invokes an engine shutdown should the communication timer with the Windows GUI overflow.  <a href="#a33c40fdd48fd7bb540f034e5c489a38b">More...</a><br /></td></tr>
<tr class="separator:a33c40fdd48fd7bb540f034e5c489a38b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ecf85c13d47309a0b3b3a39721432ae"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#a4ecf85c13d47309a0b3b3a39721432ae">ISR</a> (TIMER5_OVF_vect)</td></tr>
<tr class="memdesc:a4ecf85c13d47309a0b3b3a39721432ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt Service Routine which changes global variables should the communication with the ESB overflow.  <a href="#a4ecf85c13d47309a0b3b3a39721432ae">More...</a><br /></td></tr>
<tr class="separator:a4ecf85c13d47309a0b3b3a39721432ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17727302d45ecff548af8f81d06f3a7e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#a17727302d45ecff548af8f81d06f3a7e">readTempSensor</a> (void)</td></tr>
<tr class="memdesc:a17727302d45ecff548af8f81d06f3a7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accesses memory within the MAX6675 and converts the data into a usable temperature.  <a href="#a17727302d45ecff548af8f81d06f3a7e">More...</a><br /></td></tr>
<tr class="separator:a17727302d45ecff548af8f81d06f3a7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc85b180d655324bb96dcb29cff05af3"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#adc85b180d655324bb96dcb29cff05af3">calculateParity</a> (char message[], uint8_t start_index)</td></tr>
<tr class="memdesc:adc85b180d655324bb96dcb29cff05af3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to calculate the parity byte for a corresponding sequence of 6 bytes.  <a href="#adc85b180d655324bb96dcb29cff05af3">More...</a><br /></td></tr>
<tr class="separator:adc85b180d655324bb96dcb29cff05af3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb2fefa1023fbf227e5102e1ea3c9d4b"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a> (unsigned char byte)</td></tr>
<tr class="memdesc:adb2fefa1023fbf227e5102e1ea3c9d4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine to count the number of high bits within a designated byte.  <a href="#adb2fefa1023fbf227e5102e1ea3c9d4b">More...</a><br /></td></tr>
<tr class="separator:adb2fefa1023fbf227e5102e1ea3c9d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfac85317b9c1522c7b5196d94e471bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_c_u__funcs_8c.html#abfac85317b9c1522c7b5196d94e471bd">waitMS</a> (uint16_t msec)</td></tr>
<tr class="memdesc:abfac85317b9c1522c7b5196d94e471bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine which will wait for a given number of milliseconds.  <a href="#abfac85317b9c1522c7b5196d94e471bd">More...</a><br /></td></tr>
<tr class="separator:abfac85317b9c1522c7b5196d94e471bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation for functions for local processes on the ECU. </p>
<dl class="section author"><dt>Author</dt><dd>Nick Moore </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 20, 2018 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000002">Bug:</a></b></dt><dd>No known bugs. </dd></dl>

<p class="definition">Definition in file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aba7fa75d6dd6ebcdc6225282a798fcd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba7fa75d6dd6ebcdc6225282a798fcd2">&#9670;&nbsp;</a></span>assign_bit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assign_bit </td>
          <td>(</td>
          <td class="paramtype">volatile uint8_t *&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>bit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the specified bit to the specified value or does nothing if it already set to that. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sfr</td><td>Pointer to Special Function Register the bit is located in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bit</td><td>Denotes the bit which would like to be changed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>The value, either 1 or 0, that the user would like the bit to be after the function call. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">104</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (val)      <span class="comment">// This is for if I want the value to be a 1</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        val = (val &lt;&lt; bit);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        *sfr |= val;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">else</span>             <span class="comment">// This is for if I want the value to be a 0</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        val = ~(1 &lt;&lt; bit);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        *sfr &amp;= val;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9dc66b4b2df662c440d4d05da08e6d6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9dc66b4b2df662c440d4d05da08e6d6a">&#9670;&nbsp;</a></span>batVoltage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void batVoltage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measures the voltage on the Lipo battery from the 3 different ADC channels. </p>
<p>This performs the following functions:</p>
<p>1) Measures the ADC voltage on the current ADC channel 2) Combines this result will the current float value of the voltage 3) Changes the ADC channel to the next one in the rotation 0-&gt;1-&gt;2-&gt;0</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00025">25</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00018">bit_is_set</a>, and <a class="el" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// first check to see if the conversion has completed</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#a3b034cb1d74b9addc7599bd6ea6bd0d9">bit_is_set</a>(ADCSRA,ADSC))</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    uint8_t low_bits = ADCL;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    uint8_t high_bits = ADCH;                        <span class="comment">// Do the shifting so that there is room made inside of the 16 bit register</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    uint16_t result = (high_bits &lt;&lt; 8) | low_bits;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Now I need to convert this 16 bit number into an actual temperature</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f = 3.0 * (float) result;            <span class="comment">// Convert to float value of the voltage</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f = <a class="code" href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a>.f * (4.96 / 1024.0);      <span class="comment">// This will return Vin</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    ADCSRA |= (1 &lt;&lt; ADSC);                     <span class="comment">// Start the next conversion</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a3b034cb1d74b9addc7599bd6ea6bd0d9"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a3b034cb1d74b9addc7599bd6ea6bd0d9">bit_is_set</a></div><div class="ttdeci">#define bit_is_set(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is set. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00018">ECU_funcs.h:18</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ad849b9fe0e266552696acb467ff745f7"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad849b9fe0e266552696acb467ff745f7">voltage</a></div><div class="ttdeci">union @0 voltage</div><div class="ttdoc">Float which contains the current voltage level on the Lipo battery. </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adc85b180d655324bb96dcb29cff05af3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc85b180d655324bb96dcb29cff05af3">&#9670;&nbsp;</a></span>calculateParity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char calculateParity </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>message</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>start_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to calculate the parity byte for a corresponding sequence of 6 bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Entire message which a subset will be used in order to calculate the parity byte </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start_index</td><td>Starting index within message for which to calculate the parity byte </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>char </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00196">196</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00222">countOnes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// This will return the parity byte for a message made up of 6 sequential bytes, starting with start_index</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordtype">char</span> parity = 0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        </div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// first need to get the number of high bits in the first three bytes in the set</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keyword">set</span> = 0; <span class="keyword">set</span> &lt; 2; <span class="keyword">set</span>++){</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i = 0; i &lt; 3; i++){</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                count += <a class="code" href="_e_c_u__funcs_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a>(message[start_index + <span class="keyword">set</span>*3 + i]);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="comment">// now that I have the count for this set, I need to take the modulo</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            count = count % 16;   <span class="comment">// Modulo with 16 because I have 4 bits to play with</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            </div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="comment">// now add this into the parity byte</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            parity |= count &lt;&lt; (4 * <span class="keyword">set</span>);   <span class="comment">// this will make it so that bytes 0-2 will take up the LSB of the parity byte</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// now copy this byte into memory</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> parity;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8c_html_adb2fefa1023fbf227e5102e1ea3c9d4b"><div class="ttname"><a href="_e_c_u__funcs_8c.html#adb2fefa1023fbf227e5102e1ea3c9d4b">countOnes</a></div><div class="ttdeci">unsigned char countOnes(unsigned char byte)</div><div class="ttdoc">Subroutine to count the number of high bits within a designated byte. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00222">ECU_funcs.c:222</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adb2fefa1023fbf227e5102e1ea3c9d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb2fefa1023fbf227e5102e1ea3c9d4b">&#9670;&nbsp;</a></span>countOnes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char countOnes </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine to count the number of high bits within a designated byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>The byte by which to calculate the number of high bits within </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00222">222</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">while</span> (byte)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        count += byte &amp; 1;    <span class="comment">// this was essentially lifted from geeksforgeeks.com</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        byte &gt;&gt;= 1;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> count;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a30a0ad88a89a84c0161cf09eace108e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30a0ad88a89a84c0161cf09eace108e8">&#9670;&nbsp;</a></span>ISR() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">INT2_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt Service Routine which reads in the pulse train and increments a count. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pulse_count</td><td>This is the number which describes how many pulses have been received for the sampling period. It is an implicit argument as it is a global variable which is not explicitly passed in. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<dl class="section see"><dt>See also</dt><dd>flowMeter </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00092">92</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8h_source.html#l00138">pulse_count</a>.</p>
<div class="fragment"><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;{</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a>++;  <span class="comment">// The interrupt flag will automatically be cleared by hardware</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_af9e36069f73b8a3642ae276fd3b672a1"><div class="ttname"><a href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a></div><div class="ttdeci">uint8_t pulse_count</div><div class="ttdoc">This will keep track of how many pulses have been seen in the sampling window. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00138">ECU_funcs.h:138</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a33c40fdd48fd7bb540f034e5c489a38b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33c40fdd48fd7bb540f034e5c489a38b">&#9670;&nbsp;</a></span>ISR() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">TIMER4_OVF_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt Service Routine which invokes an engine shutdown should the communication timer with the Windows GUI overflow. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00123">123</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">assign_bit()</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00156">connected_GUI</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00147">newCommand</a>, and <a class="el" href="_engine__funcs_8c_source.html#l00024">shutdown()</a>.</p>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// If it makes it in here then the Computer is presumed to have gotten disconnected from the ECU</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR4B, CS42, 0);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    TCNT4 = 34286;                           <span class="comment">// reload the timer register</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a1c9d5e29ad8899afe0c34571ddee18f9">shutdown</a>();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#aaaa9e2d2909ceb75751c9dbfab30661c">connected_GUI</a> = 0;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a4a8bbdf0f587322d8d34a2d4b84ea8a6">newCommand</a> = 1;     <span class="comment">// this will come in handy when trying to reconnect</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a4a8bbdf0f587322d8d34a2d4b84ea8a6"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a4a8bbdf0f587322d8d34a2d4b84ea8a6">newCommand</a></div><div class="ttdeci">uint8_t newCommand</div><div class="ttdoc">Will keep track of whether or not it is possible for a new command stream to be coming in...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00147">ECU_funcs.h:147</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_a1c9d5e29ad8899afe0c34571ddee18f9"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a1c9d5e29ad8899afe0c34571ddee18f9">shutdown</a></div><div class="ttdeci">void shutdown(void)</div><div class="ttdoc">Commands the ESB to shutdown and awaits the confirmation code. </div><div class="ttdef"><b>Definition:</b> <a href="_engine__funcs_8c_source.html#l00024">Engine_funcs.c:24</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_aaaa9e2d2909ceb75751c9dbfab30661c"><div class="ttname"><a href="_e_c_u__funcs_8h.html#aaaa9e2d2909ceb75751c9dbfab30661c">connected_GUI</a></div><div class="ttdeci">uint8_t connected_GUI</div><div class="ttdoc">Essentially boolean describing if the ECU is connected to the GUI or not. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00156">ECU_funcs.h:156</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4ecf85c13d47309a0b3b3a39721432ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ecf85c13d47309a0b3b3a39721432ae">&#9670;&nbsp;</a></span>ISR() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">TIMER5_OVF_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt Service Routine which changes global variables should the communication with the ESB overflow. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00138">138</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">assign_bit()</a>, and <a class="el" href="_e_c_u__funcs_8h_source.html#l00117">opMode</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;{</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// If it makes it in here then the ESB is presumed to have gotten disconnected from the ECU</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> = 5;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR5B, CS52, 0);            <span class="comment">// turn off the timer</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    TCNT5 = ESB_timer_val;                           <span class="comment">// reload the timer register</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#a20d5783317799eb3e211c4cae2516cec">connected_ESB</a> = 0;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_a20d5783317799eb3e211c4cae2516cec"><div class="ttname"><a href="_e_c_u__funcs_8h.html#a20d5783317799eb3e211c4cae2516cec">connected_ESB</a></div><div class="ttdeci">uint8_t connected_ESB</div><div class="ttdoc">Will keep track of whether or not the ECU is connected to the windows GUI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00153">ECU_funcs.h:153</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_ab1fa4bbd357586cbfa309f1b8614c1ae"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a></div><div class="ttdeci">char opMode</div><div class="ttdoc">Holds the current operational mode of the engine. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00117">ECU_funcs.h:117</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a61322b047675f61caefcfaca81cfa48b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61322b047675f61caefcfaca81cfa48b">&#9670;&nbsp;</a></span>measureFlow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void measureFlow </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measures the fuel flow passing through the Flow meter. </p>
<p>This performs the following functions:</p>
<p>1) If the flow meter measurement has not started, it enables the appropriate interrupts and returns 2) If the flow meter measurement is in progress, it simply returns 3) If the flow meter measurement has concluded, it calculates the recorded pulses</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00054">54</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>

<p class="reference">References <a class="el" href="_e_c_u__funcs_8c_source.html#l00104">assign_bit()</a>, <a class="el" href="_e_c_u__funcs_8h_source.html#l00022">bit_is_clear</a>, and <a class="el" href="_e_c_u__funcs_8h_source.html#l00138">pulse_count</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a> = 0;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    EIMSK |= (1 &lt;&lt; INT2);    <span class="comment">// enable the external interrupts</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// Now start Timer3 to run for 0.25 sec</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    TCCR3B |= (1 &lt;&lt; CS31) | (1 &lt;&lt; CS30);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(TIFR3, TOV3));       <span class="comment">// hog execution until the overflow flag has been set</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    TIFR3 |= (1 &lt;&lt; TOV3);                    <span class="comment">// clear the interrupt flag</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// now disable the external interrupt</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;EIMSK, INT2, 0);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    </div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Now turn off Timer 3</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR3B, CS31, 0);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR3B, CS30, 0);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// Now reset the value inside of the TIMER3 register</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    TCNT3 = FlowTime;    <span class="comment">// This will allow the timer to run for 0.25 sec once the prescalars are restored</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// Now need to convert the pulses detected into an actual flow rate</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">//massFlow.f = V_per_pulse * (float) pulse_count;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">//massFlow.f = (massFlow.f - pump_b) / pump_m;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// now set the doTransmit flag</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a> &lt; 1){</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a>++;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00022">ECU_funcs.h:22</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_af9e36069f73b8a3642ae276fd3b672a1"><div class="ttname"><a href="_e_c_u__funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a></div><div class="ttdeci">uint8_t pulse_count</div><div class="ttdoc">This will keep track of how many pulses have been seen in the sampling window. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00138">ECU_funcs.h:138</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8h_html_aa8cc3e0359b222fe83e4f0351414d5a4"><div class="ttname"><a href="_e_c_u__funcs_8h.html#aa8cc3e0359b222fe83e4f0351414d5a4">doTransmit</a></div><div class="ttdeci">int8_t doTransmit</div><div class="ttdoc">Flag which is used to synchronize when messages are allowed to be sent to the GUI. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00180">ECU_funcs.h:180</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17727302d45ecff548af8f81d06f3a7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17727302d45ecff548af8f81d06f3a7e">&#9670;&nbsp;</a></span>readTempSensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readTempSensor </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accesses memory within the MAX6675 and converts the data into a usable temperature. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00152">152</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    i2c_Start(SLA_W);   <span class="comment">// this will write the temp address to the register on the sensor</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    i2c_write(0x05);    <span class="comment">// this references the temperatures location in memory</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// now restart I2C so that it will be configured for reading the temperature</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    i2c_Start(SLA_R);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// now read the upper and lower bytes</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> upper = i2c_read(1);   <span class="comment">// this will send the acknowledged bit</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> lower = i2c_read(0);   <span class="comment">// this will send the not acknowledged bit</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    i2c_Stop();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    </div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// now process the data into a usable temperature</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">//First Check flag bits</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x80) == 0x80){ <span class="comment">//TA &gt;= TCRIT</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x40) == 0x40){ <span class="comment">//TA &gt; TUPPER</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x20) == 0x20){ <span class="comment">//TA &lt; TLOWER</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    </div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    upper = upper &amp; 0x1F; <span class="comment">//Clear flag bits</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    uint8_t decimal = (lower &amp; dec_MSK) &gt;&gt; 2;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> ((upper &amp; 0x10) == 0x10){ <span class="comment">//TA &lt; 0C</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        upper = upper &amp; 0x0F; <span class="comment">//Clear SIGN</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> = (float)(256 - ((upper &lt;&lt; 4) + (lower &gt;&gt; 4)));</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> -= (0.25 * decimal);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">else</span> { <span class="comment">//TA &gt;= 0C</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> = (float)((upper &lt;&lt; 4) + (lower &gt;&gt; 4));     <span class="comment">//Temperature = Ambient Temperature (C)</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a> += (0.25 * decimal);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad0434de2efd3a26ea1211a9cec967577"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad0434de2efd3a26ea1211a9cec967577">ECU_temp</a></div><div class="ttdeci">float ECU_temp</div><div class="ttdoc">Ambient temperature of the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00165">ECU_funcs.h:165</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abfac85317b9c1522c7b5196d94e471bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfac85317b9c1522c7b5196d94e471bd">&#9670;&nbsp;</a></span>waitMS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void waitMS </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>msec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine which will wait for a given number of milliseconds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msec</td><td>Number of milliseconds to wait </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p class="definition">Definition at line <a class="el" href="_e_c_u__funcs_8c_source.html#l00238">238</a> of file <a class="el" href="_e_c_u__funcs_8c_source.html">ECU_funcs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// This function utilizes timer 0 and a sequence of delay loops to delay for the desired time</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    TCNT0 = 5;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// begin the timer</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    TCCR0B |= (1 &lt;&lt; CS01) | (1 &lt;&lt; CS00);       <span class="comment">// this will start the timer with a prescalar of 64</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; msec; i++){</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">while</span>(<a class="code" href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(TIFR0, TOV0));</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        TIFR0 |= (1 &lt;&lt; TOV0);                  <span class="comment">// Clear the overflow flag by writing a 1 to it</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0B, CS01, 0);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0B, CS00, 0);              <span class="comment">// Turn off the timer</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="ttc" id="_e_c_u__funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_e_c_u__funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8h_source.html#l00022">ECU_funcs.h:22</a></div></div>
<div class="ttc" id="_e_c_u__funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_e_c_u__funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_e_c_u__funcs_8c_source.html#l00104">ECU_funcs.c:104</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
